<!DOCTYPE html>
<!-- START: inst/pkgdown/templates/layout.html --><!-- Generated by pkgdown: do not edit by hand --><html lang="en" data-bs-theme="auto"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><title>Testing: Working with Legacy Code</title><meta name="viewport" content="width=device-width, initial-scale=1"><script src="assets/themetoggle.js"></script><link rel="stylesheet" type="text/css" href="assets/styles.css"><script src="assets/scripts.js" type="text/javascript"></script><!-- mathjax --><script type="text/x-mathjax-config">
    MathJax.Hub.Config({
      config: ["MMLorHTML.js"],
      jax: ["input/TeX","input/MathML","output/HTML-CSS","output/NativeMML", "output/PreviewHTML"],
      extensions: ["tex2jax.js","mml2jax.js","MathMenu.js","MathZoom.js", "fast-preview.js", "AssistiveMML.js", "a11y/accessibility-menu.js"],
      TeX: {
        extensions: ["AMSmath.js","AMSsymbols.js","noErrors.js","noUndefined.js"]
      },
      tex2jax: {
        inlineMath: [['\\(', '\\)']],
        displayMath: [ ['$$','$$'], ['\\[', '\\]'] ],
        processEscapes: true
      }
    });
    </script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><!-- Responsive Favicon for The Carpentries --><link rel="apple-touch-icon" sizes="180x180" href="favicons/intersect/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="favicons/intersect/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="favicons/intersect/favicon-16x16.png"><link rel="manifest" href="favicons/intersect/site.webmanifest"><link rel="mask-icon" href="favicons/intersect/safari-pinned-tab.svg" color="#5bbad5"><meta name="msapplication-TileColor" content="#da532c"><meta name="theme-color" media="(prefers-color-scheme: light)" content="white"><meta name="theme-color" media="(prefers-color-scheme: dark)" content="black"></head><body>
    <header id="top" class="navbar navbar-expand-md top-nav intersect"><svg xmlns="http://www.w3.org/2000/svg" class="d-none"><symbol id="check2" viewbox="0 0 16 16"><path d="M13.854 3.646a.5.5 0 0 1 0 .708l-7 7a.5.5 0 0 1-.708 0l-3.5-3.5a.5.5 0 1 1 .708-.708L6.5 10.293l6.646-6.647a.5.5 0 0 1 .708 0z"></path></symbol><symbol id="circle-half" viewbox="0 0 16 16"><path d="M8 15A7 7 0 1 0 8 1v14zm0 1A8 8 0 1 1 8 0a8 8 0 0 1 0 16z"></path></symbol><symbol id="moon-stars-fill" viewbox="0 0 16 16"><path d="M6 .278a.768.768 0 0 1 .08.858 7.208 7.208 0 0 0-.878 3.46c0 4.021 3.278 7.277 7.318 7.277.527 0 1.04-.055 1.533-.16a.787.787 0 0 1 .81.316.733.733 0 0 1-.031.893A8.349 8.349 0 0 1 8.344 16C3.734 16 0 12.286 0 7.71 0 4.266 2.114 1.312 5.124.06A.752.752 0 0 1 6 .278z"></path><path d="M10.794 3.148a.217.217 0 0 1 .412 0l.387 1.162c.173.518.579.924 1.097 1.097l1.162.387a.217.217 0 0 1 0 .412l-1.162.387a1.734 1.734 0 0 0-1.097 1.097l-.387 1.162a.217.217 0 0 1-.412 0l-.387-1.162A1.734 1.734 0 0 0 9.31 6.593l-1.162-.387a.217.217 0 0 1 0-.412l1.162-.387a1.734 1.734 0 0 0 1.097-1.097l.387-1.162zM13.863.099a.145.145 0 0 1 .274 0l.258.774c.115.346.386.617.732.732l.774.258a.145.145 0 0 1 0 .274l-.774.258a1.156 1.156 0 0 0-.732.732l-.258.774a.145.145 0 0 1-.274 0l-.258-.774a1.156 1.156 0 0 0-.732-.732l-.774-.258a.145.145 0 0 1 0-.274l.774-.258c.346-.115.617-.386.732-.732L13.863.1z"></path></symbol><symbol id="sun-fill" viewbox="0 0 16 16"><path d="M8 12a4 4 0 1 0 0-8 4 4 0 0 0 0 8zM8 0a.5.5 0 0 1 .5.5v2a.5.5 0 0 1-1 0v-2A.5.5 0 0 1 8 0zm0 13a.5.5 0 0 1 .5.5v2a.5.5 0 0 1-1 0v-2A.5.5 0 0 1 8 13zm8-5a.5.5 0 0 1-.5.5h-2a.5.5 0 0 1 0-1h2a.5.5 0 0 1 .5.5zM3 8a.5.5 0 0 1-.5.5h-2a.5.5 0 0 1 0-1h2A.5.5 0 0 1 3 8zm10.657-5.657a.5.5 0 0 1 0 .707l-1.414 1.415a.5.5 0 1 1-.707-.708l1.414-1.414a.5.5 0 0 1 .707 0zm-9.193 9.193a.5.5 0 0 1 0 .707L3.05 13.657a.5.5 0 0 1-.707-.707l1.414-1.414a.5.5 0 0 1 .707 0zm9.193 2.121a.5.5 0 0 1-.707 0l-1.414-1.414a.5.5 0 0 1 .707-.707l1.414 1.414a.5.5 0 0 1 0 .707zM4.464 4.465a.5.5 0 0 1-.707 0L2.343 3.05a.5.5 0 1 1 .707-.707l1.414 1.414a.5.5 0 0 1 0 .708z"></path></symbol></svg><a class="visually-hidden-focusable skip-link" href="#main-content">Skip to main content</a>
  <div class="container-fluid top-nav-container">
    <div class="col-md-8">
      <div class="large-logo">
        <img id="intersect-logo" alt="Lesson on testing" src="assets/images/intersect-logo.svg"><span class="badge text-bg-info">
          <abbr title="This lesson is in the beta phase, which means that it is ready for teaching by instructors outside of the original author team.">
            <a href="https://docs.carpentries.org/resources/curriculum/lesson-life-cycle.html" class="external-link alert-link">
              <i aria-hidden="true" class="icon" data-feather="alert-circle" style="border-radius: 5px"></i>
              Beta
            </a>
            <span class="visually-hidden">This lesson is in the beta phase, which means that it is ready for teaching by instructors outside of the original author team.</span>
          </abbr>
        </span>

      </div>
    </div>
    <div class="selector-container">
      <div id="theme-selector">
        <li class="nav-item dropdown" id="theme-button-list">
          <button class="btn btn-link nav-link px-0 px-lg-2 dropdown-toggle d-flex align-items-center" id="bd-theme" type="button" aria-expanded="false" data-bs-toggle="dropdown" data-bs-display="static" aria-label="Toggle theme (auto)">
            <svg class="bi my-1 theme-icon-active"><use href="#circle-half"></use></svg><i data-feather="chevron-down"></i>
          </button>
          <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="bd-theme-text"><li>
              <button type="button" class="btn dropdown-item d-flex align-items-center" data-bs-theme-value="light" aria-pressed="false">
                <svg class="bi me-2 theme-icon"><use href="#sun-fill"></use></svg>
                Light
                <svg class="bi ms-auto d-none"><use href="#check2"></use></svg></button>
            </li>
            <li>
              <button type="button" class="btn dropdown-item d-flex align-items-center" data-bs-theme-value="dark" aria-pressed="false">
                <svg class="bi me-2 theme-icon"><use href="#moon-stars-fill"></use></svg>
                Dark
                <svg class="bi ms-auto d-none"><use href="#check2"></use></svg></button>
            </li>
            <li>
              <button type="button" class="btn dropdown-item d-flex align-items-center active" data-bs-theme-value="auto" aria-pressed="true">
                <svg class="bi me-2 theme-icon"><use href="#circle-half"></use></svg>
                Auto
                <svg class="bi ms-auto d-none"><use href="#check2"></use></svg></button>
            </li>
          </ul></li>
      </div>

      <div class="dropdown" id="instructor-dropdown">
        <button class="btn btn-secondary dropdown-toggle bordered-button" type="button" id="dropdownMenu1" data-bs-toggle="dropdown" aria-expanded="false">
          <i aria-hidden="true" class="icon" data-feather="eye"></i> Learner View <i data-feather="chevron-down"></i>
        </button>
        <ul class="dropdown-menu" aria-labelledby="dropdownMenu1"><li><button class="dropdown-item" type="button" onclick="window.location.href='instructor/legacy-codebase.html';">Instructor View</button></li>
        </ul></div>
    </div>
  </div>
  <hr></header><nav class="navbar navbar-expand-xl bottom-nav intersect" aria-label="Main Navigation"><div class="container-fluid nav-container">
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle Navigation">
      <span class="navbar-toggler-icon"></span>
      <span class="menu-title">Menu</span>
    </button>
    <div class="nav-logo">
      <img class="small-logo" alt="Lesson on testing" src="assets/images/intersect-logo-sm.svg"></div>
    <div class="lesson-title-md">
      Testing
    </div>
    <div class="search-icon-sm">
      <!-- TODO: do not show until we have search
        <i role="img" aria-label="Search the All In One page" data-feather="search"></i>
      -->
    </div>
    <div class="desktop-nav">
      <ul class="navbar-nav me-auto mb-2 mb-lg-0"><li class="nav-item">
          <span class="lesson-title">
            Testing
          </span>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="key-points.html">Key Points</a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="reference.html#glossary">Glossary</a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="profiles.html">Learner Profiles</a>
        </li>
        <li class="nav-item dropdown">
          <button class="nav-link dropdown-toggle" id="navbarDropdown" data-bs-toggle="dropdown" aria-expanded="false">
            More <i data-feather="chevron-down"></i>
          </button>
          <ul class="dropdown-menu" aria-labelledby="navbarDropdown"><li><a class="dropdown-item" href="reference.html">Reference</a></li>
          </ul></li>
      </ul></div>
    <!--
    <form class="d-flex col-md-2 search-form">
      <fieldset disabled>
      <input class="form-control me-2 searchbox" type="search" placeholder="" aria-label="">
        <button class="btn btn-outline-success tablet-search-button"  type="submit">
          <i class="search-icon" data-feather="search" role="img" aria-label="Search the All In One page"></i>
        </button>
      </fieldset>
    </form>
    -->
    <a id="search-button" class="btn btn-primary" href="aio.html" role="button" aria-label="Search the All In One page">Search the All In One page</a>
  </div><!--/div.container-fluid -->
</nav><div class="col-md-12 mobile-title">
  Testing
</div>

<aside class="col-md-12 lesson-progress"><div style="width: 4%" class="percentage">
    4%
  </div>
  <div class="progress intersect">
    <div class="progress-bar intersect" role="progressbar" style="width: 4%" aria-valuenow="4" aria-label="Lesson Progress" aria-valuemin="0" aria-valuemax="100">
    </div>
  </div>
</aside><div class="container">
      <div class="row">
        <!-- START: inst/pkgdown/templates/navbar.html -->
<div id="sidebar-col" class="col-lg-4">
  <div id="sidebar" class="sidebar">
      <nav aria-labelledby="flush-headingEleven"><button role="button" aria-label="close menu" alt="close menu" aria-expanded="true" aria-controls="sidebar" class="collapse-toggle" data-collapse="Collapse " data-episodes="Episodes ">
          <i class="search-icon" data-feather="x" role="img"></i>
        </button>
        <div class="sidebar-inner">
          <div class="row mobile-row" id="theme-row-mobile">
            <div class="col" id="theme-selector">
              <li class="nav-item dropdown" id="theme-button-list">
                <button class="btn btn-link nav-link px-0 px-lg-2 dropdown-toggle d-flex align-items-center" id="bd-theme" type="button" aria-expanded="false" data-bs-toggle="dropdown" data-bs-display="static" aria-label="Toggle theme (auto)">
                  <svg class="bi my-1 theme-icon-active"><use href="#circle-half"></use></svg><span class="d-lg-none ms-1" id="bd-theme-text">Toggle Theme</span>
                </button>
                <ul class="dropdown-menu dropdown-menu-right" aria-labelledby="bd-theme-text"><li>
                    <button type="button" class="btn dropdown-item d-flex align-items-center" data-bs-theme-value="light" aria-pressed="false">
                      <svg class="bi me-2 theme-icon"><use href="#sun-fill"></use></svg>
                      Light
                      <svg class="bi ms-auto d-none"><use href="#check2"></use></svg></button>
                  </li>
                  <li>
                    <button type="button" class="btn dropdown-item d-flex align-items-center" data-bs-theme-value="dark" aria-pressed="false">
                      <svg class="bi me-2 theme-icon"><use href="#moon-stars-fill"></use></svg>
                      Dark
                      <svg class="bi ms-auto d-none"><use href="#check2"></use></svg></button>
                  </li>
                  <li>
                    <button type="button" class="btn dropdown-item d-flex align-items-center active" data-bs-theme-value="auto" aria-pressed="true">
                      <svg class="bi me-2 theme-icon"><use href="#circle-half"></use></svg>
                      Auto
                      <svg class="bi ms-auto d-none"><use href="#check2"></use></svg></button>
                  </li>
                </ul></li>
            </div>
          </div>
          <div class="row mobile-row">
            <div class="col">
              <div class="sidenav-view-selector">
                <div class="accordion accordion-flush" id="accordionFlush9">
                  <div class="accordion-item">
                    <h2 class="accordion-header" id="flush-headingNine">
                      <button class="accordion-button collapsed" id="instructor" type="button" data-bs-toggle="collapse" data-bs-target="#flush-collapseNine" aria-expanded="false" aria-controls="flush-collapseNine">
                        <i id="eye" aria-hidden="true" class="icon" data-feather="eye"></i> Learner View
                      </button>
                    </h2>
                    <div id="flush-collapseNine" class="accordion-collapse collapse" aria-labelledby="flush-headingNine" data-bs-parent="#accordionFlush2">
                      <div class="accordion-body">
                        <a href="instructor/legacy-codebase.html">Instructor View</a>
                      </div>
                    </div>
                  </div><!--/div.accordion-item-->
                </div><!--/div.accordion-flush-->
              </div><!--div.sidenav-view-selector -->
            </div><!--/div.col -->

            <hr></div><!--/div.mobile-row -->

          <div class="accordion accordion-flush" id="accordionFlush11">
            <div class="accordion-item">

              <button id="chapters" class="accordion-button show" type="button" data-bs-toggle="collapse" data-bs-target="#flush-collapseEleven" aria-expanded="false" aria-controls="flush-collapseEleven">
                <h2 class="accordion-header chapters" id="flush-headingEleven">
                  EPISODES
                </h2>
              </button>
              <div id="flush-collapseEleven" class="accordion-collapse show collapse" aria-labelledby="flush-headingEleven" data-bs-parent="#accordionFlush11">

                <div class="accordion-body">
                  <div class="accordion accordion-flush" id="accordionFlush1">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading1">
        <a href="index.html">Summary and Setup</a>
    </div><!--/div.accordion-header-->

  </div><!--/div.accordion-item-->
</div><!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush2">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading2">
        <a href="introduction.html">1. Introduction</a>
    </div><!--/div.accordion-header-->

  </div><!--/div.accordion-item-->
</div><!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlushcurrent">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-headingcurrent">
        <span class="visually-hidden">Current Chapter</span>
        <span class="current-chapter">
        2. Working with Legacy Code
        </span>
      
    </div><!--/div.accordion-header-->

  </div><!--/div.accordion-item-->
</div><!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush4">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading4">
        <a href="test-framework-code-cov.html">3. Test framework</a>
    </div><!--/div.accordion-header-->

  </div><!--/div.accordion-item-->
</div><!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush5">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading5">
        <a href="TDD.html">4. Test Driven Development</a>
    </div><!--/div.accordion-header-->

  </div><!--/div.accordion-item-->
</div><!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush6">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading6">
        <a href="refactor-for-testing.html">5. Refactoring for Testing</a>
    </div><!--/div.accordion-header-->

  </div><!--/div.accordion-item-->
</div><!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush7">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading7">
        <a href="big-changes.html">6. Testing Big Changes</a>
    </div><!--/div.accordion-header-->

  </div><!--/div.accordion-item-->
</div><!--/div.accordion-flush-->

                </div>
              </div>
            </div>

            <hr class="half-width"><div class="accordion accordion-flush lesson-resources" id="accordionFlush12">
              <div class="accordion-item">
                <h2 class="accordion-header" id="flush-headingTwelve">
                  <button class="accordion-button collapsed" id="lesson-resources" type="button" data-bs-toggle="collapse" data-bs-target="#flush-collapseTwelve" aria-expanded="false" aria-controls="flush-collapseTwelve">
                    RESOURCES
                  </button>
                </h2>
                <div id="flush-collapseTwelve" class="accordion-collapse collapse" aria-labelledby="flush-headingTwelve" data-bs-parent="#accordionFlush12">
                  <div class="accordion-body">
                    <ul><li>
                        <a href="key-points.html">Key Points</a>
                      </li>
                      <li>
                        <a href="reference.html#glossary">Glossary</a>
                      </li>
                      <li>
                        <a href="profiles.html">Learner Profiles</a>
                      </li>
                      <li><a href="reference.html">Reference</a></li>
                    </ul></div>
                </div>
              </div>
            </div>
            <hr class="half-width lesson-resources"><a href="aio.html">See all in one page</a>


            <hr class="d-none d-sm-block d-md-none"><div class="d-grid gap-1">

            </div>
          </div><!-- /div.accordion -->
        </div><!-- /div.sidebar-inner -->
      </nav></div><!-- /div.sidebar -->
  </div><!-- /div.sidebar-col -->
<!-- END:   inst/pkgdown/templates/navbar.html-->

        <!-- START: inst/pkgdown/templates/content-instructor.html -->
  <div class="col-xl-8 col-lg-12 primary-content">
    <nav class="lesson-content mx-md-4" aria-label="Previous and Next Chapter"><!-- content for small screens --><div class="d-block d-sm-block d-md-none">
        <a class="chapter-link" href="introduction.html"><i aria-hidden="true" class="small-arrow" data-feather="arrow-left"></i>Previous</a>
        <a class="chapter-link float-end" href="test-framework-code-cov.html">Next<i aria-hidden="true" class="small-arrow" data-feather="arrow-right"></i></a>
      </div>
      <!-- content for large screens -->
      <div class="d-none d-sm-none d-md-block">
        <a class="chapter-link" href="introduction.html" rel="prev">
          <i aria-hidden="true" class="small-arrow" data-feather="arrow-left"></i>
          Previous: Introduction
        </a>
        <a class="chapter-link float-end" href="test-framework-code-cov.html" rel="next">
          Next: Test framework...
          <i aria-hidden="true" class="small-arrow" data-feather="arrow-right"></i>
        </a>
      </div>
      <hr></nav><main id="main-content" class="main-content"><div class="container lesson-content">
        <h1>Working with Legacy Code</h1>
        <p>Last updated on 2025-05-21 |

        <a href="https://github.com/INTERSECT-training/testing-lesson/edit/main/episodes/legacy-codebase.md" class="external-link">Edit this page <i aria-hidden="true" data-feather="edit"></i></a></p>



        <div class="text-end">
          <button role="button" aria-pressed="false" tabindex="0" id="expand-code" class="pull-right" data-expand="Expand All Solutions " data-collapse="Collapse All Solutions "> Expand All Solutions <i aria-hidden="true" data-feather="plus"></i></button>
        </div>

        

<div class="overview card">
<h2 class="card-header">Overview</h2>
<div class="row g-0">
<div class="col-md-4">
<div class="card-body">
<div class="inner">
<h3 class="card-title">Questions</h3>
<ul><li>What is legacy code?</li>
<li>Why should you test legacy code before changing it?</li>
</ul></div>
</div>
</div>
<div class="col-md-8">
<div class="card-body">
<div class="inner bordered">
<h3 class="card-title">Objectives</h3>
<ul><li>Understand the sample legacy code</li>
<li>Set up an end-to-end test</li>
<li>Use TDD to begin refactoring</li>
</ul></div>
</div>
</div>
</div>
</div>
<div class="section level1">
<h1 id="meet-the-legacy-code-project">Meet the legacy code project<a class="anchor" aria-label="anchor" href="#meet-the-legacy-code-project"></a></h1>
<p>Imagine you are joining a new lab and have inherited a script from
another grad student or published paper. It takes in a file with
coordinates of rectangles and produces a matrix where the value at index
<code>i,j == 1</code> if rectangle <code>i</code> overlaps with
rectangle <code>j</code>, and <code>0</code> otherwise. Here is the
starting script</p>
<div class="codewrapper sourceCode" id="cb1">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1" tabindex="-1"></a><span class="im">import</span> sys</span>
<span id="cb1-2"><a href="#cb1-2" tabindex="-1"></a></span>
<span id="cb1-3"><a href="#cb1-3" tabindex="-1"></a></span>
<span id="cb1-4"><a href="#cb1-4" tabindex="-1"></a><span class="co"># read input file</span></span>
<span id="cb1-5"><a href="#cb1-5" tabindex="-1"></a>infile <span class="op">=</span> <span class="bu">open</span>(sys.argv[<span class="dv">1</span>], <span class="st">'r'</span>)</span>
<span id="cb1-6"><a href="#cb1-6" tabindex="-1"></a>outfile <span class="op">=</span> <span class="bu">open</span>(sys.argv[<span class="dv">2</span>], <span class="st">'w'</span>)</span>
<span id="cb1-7"><a href="#cb1-7" tabindex="-1"></a></span>
<span id="cb1-8"><a href="#cb1-8" tabindex="-1"></a><span class="co"># build rectangle struct</span></span>
<span id="cb1-9"><a href="#cb1-9" tabindex="-1"></a><span class="bu">dict</span> <span class="op">=</span> {}</span>
<span id="cb1-10"><a href="#cb1-10" tabindex="-1"></a><span class="cf">for</span> line <span class="kw">in</span> infile:</span>
<span id="cb1-11"><a href="#cb1-11" tabindex="-1"></a>    name, <span class="op">*</span>coords <span class="op">=</span> line.split()</span>
<span id="cb1-12"><a href="#cb1-12" tabindex="-1"></a>    <span class="bu">dict</span>[name] <span class="op">=</span> [<span class="bu">int</span>(c) <span class="cf">for</span> c <span class="kw">in</span> coords]</span>
<span id="cb1-13"><a href="#cb1-13" tabindex="-1"></a></span>
<span id="cb1-14"><a href="#cb1-14" tabindex="-1"></a><span class="cf">for</span> red_name, red_coords <span class="kw">in</span> <span class="bu">dict</span>.items():</span>
<span id="cb1-15"><a href="#cb1-15" tabindex="-1"></a>    <span class="cf">for</span> blue_name, blue_coords <span class="kw">in</span> <span class="bu">dict</span>.items():</span>
<span id="cb1-16"><a href="#cb1-16" tabindex="-1"></a>        <span class="co"># check if rects overlap</span></span>
<span id="cb1-17"><a href="#cb1-17" tabindex="-1"></a>        result <span class="op">=</span> <span class="st">'1'</span></span>
<span id="cb1-18"><a href="#cb1-18" tabindex="-1"></a></span>
<span id="cb1-19"><a href="#cb1-19" tabindex="-1"></a>        red_lo_x, red_lo_y, red_hi_x, red_hi_y <span class="op">=</span> red_coords</span>
<span id="cb1-20"><a href="#cb1-20" tabindex="-1"></a>        blue_lo_x, blue_lo_y, blue_hi_x, blue_hi_y <span class="op">=</span> blue_coords</span>
<span id="cb1-21"><a href="#cb1-21" tabindex="-1"></a></span>
<span id="cb1-22"><a href="#cb1-22" tabindex="-1"></a>        <span class="cf">if</span> (red_lo_x <span class="op">&gt;=</span> blue_hi_x) <span class="kw">or</span> (red_hi_x <span class="op">&lt;=</span> blue_lo_x) <span class="kw">or</span> <span class="op">\</span></span>
<span id="cb1-23"><a href="#cb1-23" tabindex="-1"></a>                (red_lo_y <span class="op">&gt;=</span> blue_hi_x) <span class="kw">or</span> (red_hi_y <span class="op">&lt;=</span> blue_lo_y):</span>
<span id="cb1-24"><a href="#cb1-24" tabindex="-1"></a>            result <span class="op">=</span> <span class="st">'0'</span></span>
<span id="cb1-25"><a href="#cb1-25" tabindex="-1"></a></span>
<span id="cb1-26"><a href="#cb1-26" tabindex="-1"></a>        outfile.write(result <span class="op">+</span> <span class="st">'</span><span class="ch">\t</span><span class="st">'</span>)</span>
<span id="cb1-27"><a href="#cb1-27" tabindex="-1"></a>    outfile.write(<span class="st">'</span><span class="ch">\n</span><span class="st">'</span>)</span>
<span id="cb1-28"><a href="#cb1-28" tabindex="-1"></a></span>
<span id="cb1-29"><a href="#cb1-29" tabindex="-1"></a>infile.close()</span>
<span id="cb1-30"><a href="#cb1-30" tabindex="-1"></a>outfile.close()</span></code></pre>
</div>
<div id="critique-the-published-version" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<div id="critique-the-published-version" class="callout-inner">
<h3 class="callout-title">Critique the published version</h3>
<div class="callout-content">
<p>The code above is certainly not perfect. Name 3 issues with the code
and (to be nice) 1 good thing.<br>
Consider if the problems will affect testing or can be addressed with
testing.</p>
</div>
</div>
</div>
<div id="accordionSolution1" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution1" aria-expanded="false" aria-controls="collapseSolution1">
  <h4 class="accordion-header" id="headingSolution1"> Show me the solution </h4>
</button>
<div id="collapseSolution1" class="accordion-collapse collapse" data-bs-parent="#accordionSolution1" aria-labelledby="headingSolution1">
<div class="accordion-body">
<p>Starting with good things: 1. Variable names are fairly clear and
properly formatted (snake case) 2. Comments are used properly 3. Runs
without errors 4. Dependencies are handled (no dependencies)</p>
<p>And some of the issues: 1. Unable to import as a module 2. No
encoding specified on <code>open</code> 3. Redundant execution in main
loop 4. Several assumptions made without checking or asserting
correctness (hi vs. low, int coords) 5. Shadowing <code>dict</code>
keywords 6. Trailing tab on the end of each output line 7. Not using
context managers for file io</p>
</div>
</div>
</div>
</div>
<p>Now your advisor wants you to take this code, make it run twice as
fast and instead of just saying if there is overlap, output the percent
the two areas overlap! You think you need to introduce a
<code>Rectangle</code> object, but how can you make changes without
adding to this pile of code?</p>
</div>
<div class="section level1">
<h1 id="a-simple-end-to-end-test">A simple end-to-end test<a class="anchor" aria-label="anchor" href="#a-simple-end-to-end-test"></a></h1>
<p>The first step to making legacy code into tested code is to add a
test.</p>
<blockquote>
<p>Legacy code has many negative connotations. Here we are using it as
defined by Micheal Feathers in <a href="https://learning.oreilly.com/library/view/working-effectively-with/0131177052/" class="external-link">Working
Effectively with Legacy Code</a>. “To me, legacy code is simply code
without tests.” All the other bad features of legacy code stem from a
lack of testing.</p>
</blockquote>
<p>Often the best test to write first is an end-to-end or integration
test. These kinds of tests exercise an entire codebase with some
“representative” input and ensure the correct output is produced. You
probably use a test like this, even if you don’t have it automated or
formalized. End-to-end tests ensure the code is working in its entirety
and giving the same output. They are often not ideal since with
non-trivial systems they can take significant time or resources to run
and verify. It is also difficult to test many corner cases without
testing smaller parts of a codebase.</p>
<p>Like all tests, passing does not verify correctness just that the
tests are not failing. Still, it is reassuring that some larger
refactoring isn’t breaking published code! Let’s start with this simple
input file (the columns are <code>name	x1	y1	x2	y2</code>):</p>
<div class="codewrapper sourceCode" id="cb2">
<h3 class="code-label">INPUT.TXT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode input.txt" tabindex="0"><code class="sourceCode default"><span id="cb2-1"><a href="#cb2-1" tabindex="-1"></a>a	0	0	2	2</span>
<span id="cb2-2"><a href="#cb2-2" tabindex="-1"></a>b	1	1	3	3</span>
<span id="cb2-3"><a href="#cb2-3" tabindex="-1"></a>c	10	10	11	11</span></code></pre>
</div>
<p>Clearly rectangles a and b overlap while c is far away. As output, we
expect the following matrix:</p>
<div class="codewrapper sourceCode" id="cb3">
<h3 class="code-label">OUTPUT.TXT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode output.txt" tabindex="0"><code class="sourceCode default"><span id="cb3-1"><a href="#cb3-1" tabindex="-1"></a>1	1	0	</span>
<span id="cb3-2"><a href="#cb3-2" tabindex="-1"></a>1	1	0	</span>
<span id="cb3-3"><a href="#cb3-3" tabindex="-1"></a>0	0	1	</span></code></pre>
</div>
<div id="critique-the-sample-input" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<div id="critique-the-sample-input" class="callout-inner">
<h3 class="callout-title">Critique the sample input</h3>
<div class="callout-content">
<p>What are some issues with the sample input? Is the result still
useful?</p>
</div>
</div>
</div>
<div id="accordionSolution2" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution2" aria-expanded="false" aria-controls="collapseSolution2">
  <h4 class="accordion-header" id="headingSolution2"> Show me the solution </h4>
</button>
<div id="collapseSolution2" class="accordion-collapse collapse" data-bs-parent="#accordionSolution2" aria-labelledby="headingSolution2">
<div class="accordion-body">
<p>The input doesn’t test rectangles where <code>x != y</code> or really
exercise the code with more interesting cases (overlap at a point, a
line, overlap exactly, etc).</p>
<p>The result can still be useful <em>if it fails</em>. Knowing
something that was working has stopped working can notify you an error
is present. However, having this test pass doesn’t make your code
correct!</p>
</div>
</div>
</div>
</div>
<p>Given the <code>input.txt</code> and <code>output.txt</code> files,
how can we test the function? You may be used to doing this manually,
with the following commands:</p>
<div class="codewrapper sourceCode" id="cb4">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb4-1"><a href="#cb4-1" tabindex="-1"></a><span class="co"># run the command</span></span>
<span id="cb4-2"><a href="#cb4-2" tabindex="-1"></a><span class="ex">python</span> overlap_v0.py input.txt new_output.txt</span>
<span id="cb4-3"><a href="#cb4-3" tabindex="-1"></a><span class="co"># view the result</span></span>
<span id="cb4-4"><a href="#cb4-4" tabindex="-1"></a><span class="fu">cat</span> new_output.txt</span>
<span id="cb4-5"><a href="#cb4-5" tabindex="-1"></a><span class="co"># compare the outputs</span></span>
<span id="cb4-6"><a href="#cb4-6" tabindex="-1"></a><span class="fu">cmp</span> output.txt new_output.txt</span></code></pre>
</div>
<p>On every change to the file, you can press the up arrow or
<code>Ctrl+p</code> to recall a command and rerun it. Bonus points if
you are using multiple terminal sessions or a multiplexer. A better
setup is to formalize this test with a script you can repeatedly run.
Tools like <a href="https://github.com/eradman/entr" class="external-link">entr</a> or your
text editor can automatically run the test when your files change. Here
is a simple end-to-end test of the initial script:</p>
<div class="codewrapper sourceCode" id="cb5">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb5-1"><a href="#cb5-1" tabindex="-1"></a><span class="co">#!/bin/bash</span></span>
<span id="cb5-2"><a href="#cb5-2" tabindex="-1"></a></span>
<span id="cb5-3"><a href="#cb5-3" tabindex="-1"></a><span class="co"># run the command</span></span>
<span id="cb5-4"><a href="#cb5-4" tabindex="-1"></a><span class="ex">python</span> overlap_v0.py input.txt new_output.txt</span>
<span id="cb5-5"><a href="#cb5-5" tabindex="-1"></a><span class="co"># compare the outputs</span></span>
<span id="cb5-6"><a href="#cb5-6" tabindex="-1"></a><span class="fu">cmp</span> output.txt new_output.txt <span class="kw">&amp;&amp;</span> <span class="bu">echo</span> <span class="st">'passes'</span></span></code></pre>
</div>
<p>When <code>cmp</code> is successful (no difference between files)
<code>passes</code> will be echoed to the terminal. When it fails the
byte and line number that differs will be printed. This script can be
run with CI and should act as the final step to ensure your outputs are
as expected. Think of tests like a funnel: you want to run quick tests
frequently to catch most bugs early, on every file write. Slower tests
can run prior to a git commit to catch the bugs that escaped the first
round. Finally, the slowest, most thorough tests run via CI/CD on a PR
and should catch a minority of bugs. We will run our end to end test
after making major changes.</p>
<p>You can also add more test files to this script but we want to move
to a better testing framework ASAP!</p>
<div id="keypoints1" class="callout keypoints">
<div class="callout-square">
<i class="callout-icon" data-feather="key"></i>
</div>
<div class="callout-inner">
<h3 class="callout-title">Key Points</h3>
<div class="callout-content">
<ul><li>Legacy code is code without tests. It’s extremely challenging to
change code that doesn’t have tests.</li>
<li>At the very least you should have an end-to-end test when starting
to change code.</li>
<li>Try to add tests before making changes, work in small steps.</li>
<li>Having tests pass doesn’t mean your code is correct.</li>
</ul></div>
</div>
</div>
<!--
Place links that you need to refer to multiple times across pages here. Delete
any links that you are not going to use.
 -->
</div>



      </div> <!-- / div.lesson-content -->
    </main><!-- / main#main-content.main-content --><nav class="bottom-pagination mx-md-4" aria-label="Previous and Next Chapter"><div class="d-block d-sm-block d-md-none">
        <a class="chapter-link" href="introduction.html"><i aria-hidden="true" class="small-arrow" data-feather="arrow-left"></i>Previous</a>
        <a class="chapter-link float-end" href="test-framework-code-cov.html">Next<i aria-hidden="true" class="small-arrow" data-feather="arrow-right"></i></a>
      </div>
      <!-- content for large screens -->
      <div class="d-none d-sm-none d-md-block">
        <a class="chapter-link" href="introduction.html" rel="prev">
          <i aria-hidden="true" class="small-arrow" data-feather="arrow-left"></i>
          Previous: Introduction
        </a>
        <a class="chapter-link float-end" href="test-framework-code-cov.html" rel="next">
          Next: Test framework...
          <i aria-hidden="true" class="small-arrow" data-feather="arrow-right"></i>
        </a>
      </div>
    </nav></div> <!-- / div.primary-content.col-xs-12 -->
<!-- END:   inst/pkgdown/templates/content-instructor.html-->

      </div><!--/div.row-->
      		<footer class="row footer mx-md-3"><hr><div class="col-md-6">
        <p>This lesson is subject to the <a href="CODE_OF_CONDUCT.html">Code of Conduct</a></p>
        <p>

        <a href="https://github.com/INTERSECT-training/testing-lesson/edit/main/episodes/legacy-codebase.md" class="external-link">Edit on GitHub</a>

	
        | <a href="https://github.com/INTERSECT-training/testing-lesson/blob/main/CONTRIBUTING.md" class="external-link">Contributing</a>
        | <a href="https://github.com/INTERSECT-training/testing-lesson/" class="external-link">Source</a></p>
				<p><a href="https://github.com/INTERSECT-training/testing-lesson/blob/main/CITATION.cff" class="external-link">Cite</a> | <a href="mailto:icosden@princeton.edu">Contact</a> | <a href="https://carpentries.org/about/" class="external-link">About</a></p>
			</div>
			<div class="col-md-6">

        <p>Materials licensed under <a href="LICENSE.html">CC-BY 4.0</a> by the authors</p>

        <p>Template licensed under <a href="https://creativecommons.org/licenses/by-sa/4.0/" class="external-link">CC-BY 4.0</a> by <a href="https://carpentries.org/" class="external-link">The Carpentries</a></p>
        <p>Built with <a href="https://github.com/carpentries/sandpaper/tree/0.16.12" class="external-link">sandpaper (0.16.12)</a>, <a href="https://github.com/carpentries/pegboard/tree/0.7.9" class="external-link">pegboard (0.7.9)</a>, and <a href="https://github.com/intersect-training/varnish/tree/406bb97bab56e8a0c29f2f362164c5d4a05b7ee1" class="external-link">varnish (1.0.7.9000)</a></p>
			</div>
		</footer></div> <!-- / div.container -->
	<div id="to-top">
		<a href="#top">
      <i class="search-icon" data-feather="arrow-up" role="img" aria-label="Back To Top"></i><br><!-- <span class="d-none d-sm-none d-md-none d-lg-none d-xl-block">Back</span> To Top --><span class="d-none d-sm-none d-md-none d-lg-none d-xl-block">Back</span> To Top
		</a>
	</div>
  <script type="application/ld+json">
    {
  "@context": "https://schema.org",
  "@type": "LearningResource",
  "@id": "https://INTERSECT-training.github.io/testing-lesson/legacy-codebase.html",
  "inLanguage": "en",
  "dct:conformsTo": "https://bioschemas.org/profiles/LearningResource/1.0-RELEASE",
  "description": "A Carpentries Lesson teaching foundational data and coding skills to researchers worldwide",
  "keywords": "software, data, lesson, The Carpentries",
  "name": "Working with Legacy Code",
  "creativeWorkStatus": "active",
  "url": "https://INTERSECT-training.github.io/testing-lesson/legacy-codebase.html",
  "identifier": "https://INTERSECT-training.github.io/testing-lesson/legacy-codebase.html",
  "dateCreated": "2025-05-21",
  "dateModified": "2025-05-21",
  "datePublished": "2025-06-10"
}

  </script><script>
		feather.replace();
	</script></body></html><!-- END:   inst/pkgdown/templates/layout.html-->

