<!DOCTYPE html>
<!-- START: inst/pkgdown/templates/layout.html --><!-- Generated by pkgdown: do not edit by hand --><html lang="en" data-bs-theme="auto"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><title>Testing: Test Driven Development</title><meta name="viewport" content="width=device-width, initial-scale=1"><script src="../assets/themetoggle.js"></script><link rel="stylesheet" type="text/css" href="../assets/styles.css"><script src="../assets/scripts.js" type="text/javascript"></script><!-- mathjax --><script type="text/x-mathjax-config">
    MathJax.Hub.Config({
      config: ["MMLorHTML.js"],
      jax: ["input/TeX","input/MathML","output/HTML-CSS","output/NativeMML", "output/PreviewHTML"],
      extensions: ["tex2jax.js","mml2jax.js","MathMenu.js","MathZoom.js", "fast-preview.js", "AssistiveMML.js", "a11y/accessibility-menu.js"],
      TeX: {
        extensions: ["AMSmath.js","AMSsymbols.js","noErrors.js","noUndefined.js"]
      },
      tex2jax: {
        inlineMath: [['\\(', '\\)']],
        displayMath: [ ['$$','$$'], ['\\[', '\\]'] ],
        processEscapes: true
      }
    });
    </script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><!-- Responsive Favicon for The Carpentries --><link rel="apple-touch-icon" sizes="180x180" href="../favicons/intersect/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="../favicons/intersect/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="../favicons/intersect/favicon-16x16.png"><link rel="manifest" href="../favicons/intersect/site.webmanifest"><link rel="mask-icon" href="../favicons/intersect/safari-pinned-tab.svg" color="#5bbad5"><meta name="msapplication-TileColor" content="#da532c"><meta name="theme-color" media="(prefers-color-scheme: light)" content="white"><meta name="theme-color" media="(prefers-color-scheme: dark)" content="black"></head><body>
    <header id="top" class="navbar navbar-expand-md top-nav intersect"><svg xmlns="http://www.w3.org/2000/svg" class="d-none"><symbol id="check2" viewbox="0 0 16 16"><path d="M13.854 3.646a.5.5 0 0 1 0 .708l-7 7a.5.5 0 0 1-.708 0l-3.5-3.5a.5.5 0 1 1 .708-.708L6.5 10.293l6.646-6.647a.5.5 0 0 1 .708 0z"></path></symbol><symbol id="circle-half" viewbox="0 0 16 16"><path d="M8 15A7 7 0 1 0 8 1v14zm0 1A8 8 0 1 1 8 0a8 8 0 0 1 0 16z"></path></symbol><symbol id="moon-stars-fill" viewbox="0 0 16 16"><path d="M6 .278a.768.768 0 0 1 .08.858 7.208 7.208 0 0 0-.878 3.46c0 4.021 3.278 7.277 7.318 7.277.527 0 1.04-.055 1.533-.16a.787.787 0 0 1 .81.316.733.733 0 0 1-.031.893A8.349 8.349 0 0 1 8.344 16C3.734 16 0 12.286 0 7.71 0 4.266 2.114 1.312 5.124.06A.752.752 0 0 1 6 .278z"></path><path d="M10.794 3.148a.217.217 0 0 1 .412 0l.387 1.162c.173.518.579.924 1.097 1.097l1.162.387a.217.217 0 0 1 0 .412l-1.162.387a1.734 1.734 0 0 0-1.097 1.097l-.387 1.162a.217.217 0 0 1-.412 0l-.387-1.162A1.734 1.734 0 0 0 9.31 6.593l-1.162-.387a.217.217 0 0 1 0-.412l1.162-.387a1.734 1.734 0 0 0 1.097-1.097l.387-1.162zM13.863.099a.145.145 0 0 1 .274 0l.258.774c.115.346.386.617.732.732l.774.258a.145.145 0 0 1 0 .274l-.774.258a1.156 1.156 0 0 0-.732.732l-.258.774a.145.145 0 0 1-.274 0l-.258-.774a1.156 1.156 0 0 0-.732-.732l-.774-.258a.145.145 0 0 1 0-.274l.774-.258c.346-.115.617-.386.732-.732L13.863.1z"></path></symbol><symbol id="sun-fill" viewbox="0 0 16 16"><path d="M8 12a4 4 0 1 0 0-8 4 4 0 0 0 0 8zM8 0a.5.5 0 0 1 .5.5v2a.5.5 0 0 1-1 0v-2A.5.5 0 0 1 8 0zm0 13a.5.5 0 0 1 .5.5v2a.5.5 0 0 1-1 0v-2A.5.5 0 0 1 8 13zm8-5a.5.5 0 0 1-.5.5h-2a.5.5 0 0 1 0-1h2a.5.5 0 0 1 .5.5zM3 8a.5.5 0 0 1-.5.5h-2a.5.5 0 0 1 0-1h2A.5.5 0 0 1 3 8zm10.657-5.657a.5.5 0 0 1 0 .707l-1.414 1.415a.5.5 0 1 1-.707-.708l1.414-1.414a.5.5 0 0 1 .707 0zm-9.193 9.193a.5.5 0 0 1 0 .707L3.05 13.657a.5.5 0 0 1-.707-.707l1.414-1.414a.5.5 0 0 1 .707 0zm9.193 2.121a.5.5 0 0 1-.707 0l-1.414-1.414a.5.5 0 0 1 .707-.707l1.414 1.414a.5.5 0 0 1 0 .707zM4.464 4.465a.5.5 0 0 1-.707 0L2.343 3.05a.5.5 0 1 1 .707-.707l1.414 1.414a.5.5 0 0 1 0 .708z"></path></symbol></svg><a class="visually-hidden-focusable skip-link" href="#main-content">Skip to main content</a>
  <div class="container-fluid top-nav-container">
    <div class="col-md-8">
      <div class="large-logo">
        <img id="intersect-logo" alt="Lesson on testing" src="../assets/images/intersect-logo.svg"><span class="badge text-bg-info">
          <abbr title="This lesson is in the beta phase, which means that it is ready for teaching by instructors outside of the original author team.">
            <a href="https://docs.carpentries.org/resources/curriculum/lesson-life-cycle.html" class="external-link alert-link">
              <i aria-hidden="true" class="icon" data-feather="alert-circle" style="border-radius: 5px"></i>
              Beta
            </a>
            <span class="visually-hidden">This lesson is in the beta phase, which means that it is ready for teaching by instructors outside of the original author team.</span>
          </abbr>
        </span>

      </div>
    </div>
    <div class="selector-container">
      <div id="theme-selector">
        <li class="nav-item dropdown" id="theme-button-list">
          <button class="btn btn-link nav-link px-0 px-lg-2 dropdown-toggle d-flex align-items-center" id="bd-theme" type="button" aria-expanded="false" data-bs-toggle="dropdown" data-bs-display="static" aria-label="Toggle theme (auto)">
            <svg class="bi my-1 theme-icon-active"><use href="#circle-half"></use></svg><i data-feather="chevron-down"></i>
          </button>
          <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="bd-theme-text"><li>
              <button type="button" class="btn dropdown-item d-flex align-items-center" data-bs-theme-value="light" aria-pressed="false">
                <svg class="bi me-2 theme-icon"><use href="#sun-fill"></use></svg>
                Light
                <svg class="bi ms-auto d-none"><use href="#check2"></use></svg></button>
            </li>
            <li>
              <button type="button" class="btn dropdown-item d-flex align-items-center" data-bs-theme-value="dark" aria-pressed="false">
                <svg class="bi me-2 theme-icon"><use href="#moon-stars-fill"></use></svg>
                Dark
                <svg class="bi ms-auto d-none"><use href="#check2"></use></svg></button>
            </li>
            <li>
              <button type="button" class="btn dropdown-item d-flex align-items-center active" data-bs-theme-value="auto" aria-pressed="true">
                <svg class="bi me-2 theme-icon"><use href="#circle-half"></use></svg>
                Auto
                <svg class="bi ms-auto d-none"><use href="#check2"></use></svg></button>
            </li>
          </ul></li>
      </div>

      <div class="dropdown" id="instructor-dropdown">
        <button class="btn btn-secondary dropdown-toggle bordered-button" type="button" id="dropdownMenu1" data-bs-toggle="dropdown" aria-expanded="false">
          <i aria-hidden="true" class="icon" data-feather="eye"></i> Instructor View <i data-feather="chevron-down"></i>
        </button>
        <ul class="dropdown-menu" aria-labelledby="dropdownMenu1"><li><button class="dropdown-item" type="button" onclick="window.location.href='../TDD.html';">Learner View</button></li>
        </ul></div>
    </div>
  </div>
  <hr></header><nav class="navbar navbar-expand-xl bottom-nav intersect" aria-label="Main Navigation"><div class="container-fluid nav-container">
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle Navigation">
      <span class="navbar-toggler-icon"></span>
      <span class="menu-title">Menu</span>
    </button>
    <div class="nav-logo">
      <img class="small-logo" alt="Lesson on testing" src="../assets/images/intersect-logo-sm.svg"></div>
    <div class="lesson-title-md">
      Testing
    </div>
    <div class="search-icon-sm">
      <!-- TODO: do not show until we have search
        <i role="img" aria-label="Search the All In One page" data-feather="search"></i>
      -->
    </div>
    <div class="desktop-nav">
      <ul class="navbar-nav me-auto mb-2 mb-lg-0"><li class="nav-item">
          <span class="lesson-title">
            Testing
          </span>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="../instructor/key-points.html">Key Points</a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="../instructor/instructor-notes.html">Instructor Notes</a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="../instructor/images.html">Extract All Images</a>
        </li>
        <li class="nav-item dropdown">
          <button class="nav-link dropdown-toggle" id="navbarDropdown" data-bs-toggle="dropdown" aria-expanded="false">
            More <i data-feather="chevron-down"></i>
          </button>
          <ul class="dropdown-menu" aria-labelledby="navbarDropdown"><hr><li><a class="dropdown-item" href="reference.html">Reference</a></li>
          </ul></li>
      </ul></div>
    <!--
    <form class="d-flex col-md-2 search-form">
      <fieldset disabled>
      <input class="form-control me-2 searchbox" type="search" placeholder="" aria-label="">
        <button class="btn btn-outline-success tablet-search-button"  type="submit">
          <i class="search-icon" data-feather="search" role="img" aria-label="Search the All In One page"></i>
        </button>
      </fieldset>
    </form>
    -->
    <a id="search-button" class="btn btn-primary" href="../instructor/aio.html" role="button" aria-label="Search the All In One page">Search the All In One page</a>
  </div><!--/div.container-fluid -->
</nav><div class="col-md-12 mobile-title">
  Testing
</div>

<aside class="col-md-12 lesson-progress"><div style="width: 33%" class="percentage">
    33%
  </div>
  <div class="progress intersect">
    <div class="progress-bar intersect" role="progressbar" style="width: 33%" aria-valuenow="33" aria-label="Lesson Progress" aria-valuemin="0" aria-valuemax="100">
    </div>
  </div>
</aside><div class="container">
      <div class="row">
        <!-- START: inst/pkgdown/templates/navbar.html -->
<div id="sidebar-col" class="col-lg-4">
  <div id="sidebar" class="sidebar">
      <nav aria-labelledby="flush-headingEleven"><button role="button" aria-label="close menu" alt="close menu" aria-expanded="true" aria-controls="sidebar" class="collapse-toggle" data-collapse="Collapse " data-episodes="Episodes ">
          <i class="search-icon" data-feather="x" role="img"></i>
        </button>
        <div class="sidebar-inner">
          <div class="row mobile-row" id="theme-row-mobile">
            <div class="col" id="theme-selector">
              <li class="nav-item dropdown" id="theme-button-list">
                <button class="btn btn-link nav-link px-0 px-lg-2 dropdown-toggle d-flex align-items-center" id="bd-theme" type="button" aria-expanded="false" data-bs-toggle="dropdown" data-bs-display="static" aria-label="Toggle theme (auto)">
                  <svg class="bi my-1 theme-icon-active"><use href="#circle-half"></use></svg><span class="d-lg-none ms-1" id="bd-theme-text">Toggle Theme</span>
                </button>
                <ul class="dropdown-menu dropdown-menu-right" aria-labelledby="bd-theme-text"><li>
                    <button type="button" class="btn dropdown-item d-flex align-items-center" data-bs-theme-value="light" aria-pressed="false">
                      <svg class="bi me-2 theme-icon"><use href="#sun-fill"></use></svg>
                      Light
                      <svg class="bi ms-auto d-none"><use href="#check2"></use></svg></button>
                  </li>
                  <li>
                    <button type="button" class="btn dropdown-item d-flex align-items-center" data-bs-theme-value="dark" aria-pressed="false">
                      <svg class="bi me-2 theme-icon"><use href="#moon-stars-fill"></use></svg>
                      Dark
                      <svg class="bi ms-auto d-none"><use href="#check2"></use></svg></button>
                  </li>
                  <li>
                    <button type="button" class="btn dropdown-item d-flex align-items-center active" data-bs-theme-value="auto" aria-pressed="true">
                      <svg class="bi me-2 theme-icon"><use href="#circle-half"></use></svg>
                      Auto
                      <svg class="bi ms-auto d-none"><use href="#check2"></use></svg></button>
                  </li>
                </ul></li>
            </div>
          </div>
          <div class="row mobile-row">
            <div class="col">
              <div class="sidenav-view-selector">
                <div class="accordion accordion-flush" id="accordionFlush9">
                  <div class="accordion-item">
                    <h2 class="accordion-header" id="flush-headingNine">
                      <button class="accordion-button collapsed" id="instructor" type="button" data-bs-toggle="collapse" data-bs-target="#flush-collapseNine" aria-expanded="false" aria-controls="flush-collapseNine">
                        <i id="eye" aria-hidden="true" class="icon" data-feather="eye"></i> Instructor View
                      </button>
                    </h2>
                    <div id="flush-collapseNine" class="accordion-collapse collapse" aria-labelledby="flush-headingNine" data-bs-parent="#accordionFlush2">
                      <div class="accordion-body">
                        <a href="../TDD.html">Learner View</a>
                      </div>
                    </div>
                  </div><!--/div.accordion-item-->
                </div><!--/div.accordion-flush-->
              </div><!--div.sidenav-view-selector -->
            </div><!--/div.col -->

            <hr></div><!--/div.mobile-row -->

          <div class="accordion accordion-flush" id="accordionFlush11">
            <div class="accordion-item">

              <button id="chapters" class="accordion-button show" type="button" data-bs-toggle="collapse" data-bs-target="#flush-collapseEleven" aria-expanded="false" aria-controls="flush-collapseEleven">
                <h2 class="accordion-header chapters" id="flush-headingEleven">
                  EPISODES
                </h2>
              </button>
              <div id="flush-collapseEleven" class="accordion-collapse show collapse" aria-labelledby="flush-headingEleven" data-bs-parent="#accordionFlush11">

                <div class="accordion-body">
                  <div class="accordion accordion-flush" id="accordionFlush1">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading1">
        <a href="index.html">Summary and Schedule</a>
    </div><!--/div.accordion-header-->

  </div><!--/div.accordion-item-->
</div><!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush2">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading2">
        <a href="introduction.html">1. Introduction</a>
    </div><!--/div.accordion-header-->

  </div><!--/div.accordion-item-->
</div><!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush3">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading3">
        <a href="legacy-codebase.html">2. Working with Legacy Code</a>
    </div><!--/div.accordion-header-->

  </div><!--/div.accordion-item-->
</div><!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush4">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading4">
        <a href="test-framework-code-cov.html">3. Test framework</a>
    </div><!--/div.accordion-header-->

  </div><!--/div.accordion-item-->
</div><!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlushcurrent">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-headingcurrent">
        <span class="visually-hidden">Current Chapter</span>
        <span class="current-chapter">
        4. Test Driven Development
        </span>
      
    </div><!--/div.accordion-header-->

  </div><!--/div.accordion-item-->
</div><!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush6">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading6">
        <a href="refactor-for-testing.html">5. Refactoring for Testing</a>
    </div><!--/div.accordion-header-->

  </div><!--/div.accordion-item-->
</div><!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush7">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading7">
        <a href="big-changes.html">6. Testing Big Changes</a>
    </div><!--/div.accordion-header-->

  </div><!--/div.accordion-item-->
</div><!--/div.accordion-flush-->

                </div>
              </div>
            </div>

            <hr class="half-width"><div class="accordion accordion-flush lesson-resources" id="accordionFlush12">
              <div class="accordion-item">
                <h2 class="accordion-header" id="flush-headingTwelve">
                  <button class="accordion-button collapsed" id="lesson-resources" type="button" data-bs-toggle="collapse" data-bs-target="#flush-collapseTwelve" aria-expanded="false" aria-controls="flush-collapseTwelve">
                    RESOURCES
                  </button>
                </h2>
                <div id="flush-collapseTwelve" class="accordion-collapse collapse" aria-labelledby="flush-headingTwelve" data-bs-parent="#accordionFlush12">
                  <div class="accordion-body">
                    <ul><li>
                        <a href="../instructor/key-points.html">Key Points</a>
                      </li>
                      <li>
                        <a href="../instructor/instructor-notes.html">Instructor Notes</a>
                      </li>
                      <li>
                        <a href="../instructor/images.html">Extract All Images</a>
                      </li>
                      <hr><li><a class="dropdown-item" href="reference.html">Reference</a></li>
                    </ul></div>
                </div>
              </div>
            </div>
            <hr class="half-width lesson-resources"><a href="../instructor/aio.html">See all in one page</a>


            <hr class="d-none d-sm-block d-md-none"><div class="d-grid gap-1">

            </div>
          </div><!-- /div.accordion -->
        </div><!-- /div.sidebar-inner -->
      </nav></div><!-- /div.sidebar -->
  </div><!-- /div.sidebar-col -->
<!-- END:   inst/pkgdown/templates/navbar.html-->

        <!-- START: inst/pkgdown/templates/content-instructor.html -->
  <div class="col-xl-8 col-lg-12 primary-content">
    <nav class="lesson-content mx-md-4" aria-label="Previous and Next Chapter"><!-- content for small screens --><div class="d-block d-sm-block d-md-none">
        <a class="chapter-link" href="../instructor/test-framework-code-cov.html"><i aria-hidden="true" class="small-arrow" data-feather="arrow-left"></i>Previous</a>
        <a class="chapter-link float-end" href="../instructor/refactor-for-testing.html">Next<i aria-hidden="true" class="small-arrow" data-feather="arrow-right"></i></a>
      </div>
      <!-- content for large screens -->
      <div class="d-none d-sm-none d-md-block">
        <a class="chapter-link" href="../instructor/test-framework-code-cov.html" rel="prev">
          <i aria-hidden="true" class="small-arrow" data-feather="arrow-left"></i>
          Previous: Test framework
        </a>
        <a class="chapter-link float-end" href="../instructor/refactor-for-testing.html" rel="next">
          Next: Refactoring for...
          <i aria-hidden="true" class="small-arrow" data-feather="arrow-right"></i>
        </a>
      </div>
      <hr></nav><main id="main-content" class="main-content"><div class="container lesson-content">
        <h1>Test Driven Development</h1>
        <p>Last updated on 2025-05-21 |

        <a href="https://github.com/INTERSECT-training/testing-lesson/edit/main/episodes/TDD.md" class="external-link">Edit this page <i aria-hidden="true" data-feather="edit"></i></a></p>



        <p>Estimated time: <i aria-hidden="true" data-feather="clock"></i> 30 minutes</p>

        <div class="text-end">
          <button role="button" aria-pressed="false" tabindex="0" id="expand-code" class="pull-right" data-expand="Expand All Solutions " data-collapse="Collapse All Solutions "> Expand All Solutions <i aria-hidden="true" data-feather="plus"></i></button>
        </div>

        

<div class="overview card">
<h2 class="card-header">Overview</h2>
<div class="row g-0">
<div class="col-md-4">
<div class="card-body">
<div class="inner">
<h3 class="card-title">Questions</h3>
<ul><li>Why should you write tests first?</li>
<li>What are the 3 phases of TDD?</li>
</ul></div>
</div>
</div>
<div class="col-md-8">
<div class="card-body">
<div class="inner bordered">
<h3 class="card-title">Objectives</h3>
<ul><li>Start running tests with pytest.</li>
<li>Replace the end-to-end test with a pytest version.</li>
</ul></div>
</div>
</div>
</div>
</div>
<div class="section level1">
<h1 id="test-driven-development">Test Driven Development<a class="anchor" aria-label="anchor" href="#test-driven-development"></a></h1>
<p>Test Driven Development (or TDD) has a history in agile development
but put simply you’re going to write tests <em>before</em> you write
code (or nearly the same time). This is in contrast to the historical
“waterfall” development cycle where tests were developed after code was
written e.g. on a separate day or business quarter.</p>
<p>You don’t have to be a TDD purist as long as your code ends up having
tests. Some say TDD makes code less buggy, though that may not be
strictly true. Still, TDD provides at least three major benefits:</p>
<ul><li><p>It greatly informs the <em>design</em>, making for more
maintainable, legible and generally pretty code. Writing code is much
faster since you’ve already made the difficult decisions about its
interface.</p></li>
<li><p>It ensures that tests will <em>exist</em> in the first place (b/c
you are writing them first). Remember, everyone dislikes writing tests,
so you should hack yourself to get them done.</p></li>
<li><p>It makes writing tests A LOT more fun and enjoyable. That’s
because writing tests when there’s no code yet is a huge puzzle that
feels more like problem-solving (which is what programmers like) than
clerical work or bookkeeping (which programmers generally
despise).</p></li>
</ul><p>Often times when you write tests with existing code, you anchor your
expectations based on what the code does, instead of brain storming on
what a user could do to break your system.</p>
<div class="section level2">
<h2 id="red-green-refactor">Red, green, refactor<a class="anchor" aria-label="anchor" href="#red-green-refactor"></a></h2>
<p>The basic cycle of work with TDD is called <strong>red</strong>,
<strong>green</strong>, <strong>refactor</strong>: - Start by writing a
failing test. This is the <strong>red</strong> phase since your test
runner will show a failure, usually with a red color. Only when you
having a failing test can you add a feature. - Add only as much code to
make the test pass (<strong>green</strong>). You want to work on the
code base only until your tests are passing, then stop! This is often
difficult if you are struck by inspiration but try to slow down and add
a note to come back to. Maybe you identified the next test to write! -
Look over your code <em>and tests</em> and see if anything should be
<em>refactored</em>. Refactoring is the process of restructuring or
improving the internal structure of existing source code without
changing its external behavior. It can involve modifications to the code
to make it more readable, maintainable, efficient, and adhering to best
coding practices. At this point your test suite is passing and you can
really get creative. If a change causes something to break you can
easily undo it and get back to safety. Also, having this as a separate
step allows you to focus on testing and writing code in the other
phases. Remember, tests are code too and benefit from the same design
considerations.</p>
<p>You will be repeating these red, green, refactor steps multiple times
until you are done with developing code. Therefore we need to automate
the execution of tests using testing frameworks. Here we will be using
<strong>pytest</strong>, which is a widely used testing framework for
Python. It provides a comprehensive and flexible set of tools and
features for writing and executing tests.</p>
</div>
<div class="section level2">
<h2 id="importing-overlap-py-red-green-refactor">Importing overlap.py, red-green-refactor<a class="anchor" aria-label="anchor" href="#importing-overlap-py-red-green-refactor"></a></h2>
<p>Getting back to the overlap script, let’s start with a failing
test.</p>
<div class="section level3">
<h3 id="red">Red<a class="anchor" aria-label="anchor" href="#red"></a></h3>
<p>You may be surprised how easy it is to fail:</p>
<div class="codewrapper sourceCode" id="cb1">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1" tabindex="-1"></a><span class="co"># test_overlap.py</span></span>
<span id="cb1-2"><a href="#cb1-2" tabindex="-1"></a></span>
<span id="cb1-3"><a href="#cb1-3" tabindex="-1"></a><span class="im">import</span> overlap_v0 <span class="im">as</span> overlap  <span class="co"># change version as needed</span></span>
<span id="cb1-4"><a href="#cb1-4" tabindex="-1"></a></span>
<span id="cb1-5"><a href="#cb1-5" tabindex="-1"></a><span class="kw">def</span> test_import():</span>
<span id="cb1-6"><a href="#cb1-6" tabindex="-1"></a>    <span class="cf">pass</span></span></code></pre>
</div>
<p>When you run pytest, you get an error due to the line opening
<code>sys.argv[1]</code> when we aren’t providing an input file. Note
how brittle the original design is, if we wanted to use part of the file
somewhere else we aren’t able to since the file expects to be called as
the main method. If you wanted to change command line parsers or use
some part in a notebook, you would quickly run into problems.</p>
</div>
<div class="section level3">
<h3 id="green">Green<a class="anchor" aria-label="anchor" href="#green"></a></h3>
<p>Maybe you are thinking about how to pull file IO out of this
function, but to start we do the least amount possible to pass our test
(which is really just importing):</p>
<div class="codewrapper sourceCode" id="cb2">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb2-1"><a href="#cb2-1" tabindex="-1"></a><span class="co"># overlap.py</span></span>
<span id="cb2-2"><a href="#cb2-2" tabindex="-1"></a></span>
<span id="cb2-3"><a href="#cb2-3" tabindex="-1"></a><span class="im">import</span> sys</span>
<span id="cb2-4"><a href="#cb2-4" tabindex="-1"></a></span>
<span id="cb2-5"><a href="#cb2-5" tabindex="-1"></a><span class="kw">def</span> main():</span>
<span id="cb2-6"><a href="#cb2-6" tabindex="-1"></a>    <span class="co"># read input file</span></span>
<span id="cb2-7"><a href="#cb2-7" tabindex="-1"></a>    infile <span class="op">=</span> <span class="bu">open</span>(sys.argv[<span class="dv">1</span>], <span class="st">'r'</span>)</span>
<span id="cb2-8"><a href="#cb2-8" tabindex="-1"></a>    outfile <span class="op">=</span> <span class="bu">open</span>(sys.argv[<span class="dv">2</span>], <span class="st">'w'</span>)</span>
<span id="cb2-9"><a href="#cb2-9" tabindex="-1"></a>    <span class="co"># ...</span></span>
<span id="cb2-10"><a href="#cb2-10" tabindex="-1"></a></span>
<span id="cb2-11"><a href="#cb2-11" tabindex="-1"></a><span class="cf">if</span> <span class="va">__name__</span> <span class="op">==</span> <span class="st">"__main__"</span>:</span>
<span id="cb2-12"><a href="#cb2-12" tabindex="-1"></a>    main()</span></code></pre>
</div>
<p>Now execute test_overlap.py with pytest:</p>
<div class="codewrapper sourceCode" id="cb3">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb3-1"><a href="#cb3-1" tabindex="-1"></a><span class="ex">$</span> pytest test_overlap.py</span>
<span id="cb3-2"><a href="#cb3-2" tabindex="-1"></a><span class="ex">==========================================</span> test session starts ===========================================</span>
<span id="cb3-3"><a href="#cb3-3" tabindex="-1"></a><span class="ex">platform</span> linux <span class="at">--</span> Python 3.9.16, pytest-7.3.1, pluggy-1.0.0</span>
<span id="cb3-4"><a href="#cb3-4" tabindex="-1"></a><span class="ex">rootdir:</span> ~/projects/testing-lesson/files</span>
<span id="cb3-5"><a href="#cb3-5" tabindex="-1"></a><span class="ex">plugins:</span> anyio-3.6.2</span>
<span id="cb3-6"><a href="#cb3-6" tabindex="-1"></a><span class="ex">collected</span> 1 item</span>
<span id="cb3-7"><a href="#cb3-7" tabindex="-1"></a></span>
<span id="cb3-8"><a href="#cb3-8" tabindex="-1"></a><span class="ex">test_overlap.py</span> .                                                                                  <span class="pp">[</span><span class="ss">100%</span><span class="pp">]</span></span>
<span id="cb3-9"><a href="#cb3-9" tabindex="-1"></a></span>
<span id="cb3-10"><a href="#cb3-10" tabindex="-1"></a><span class="ex">===========================================</span> 1 passed in 0.01s ============================================</span></code></pre>
</div>
<p>You can be extra thorough and see if <code>end-to-end.sh</code> still
passes.</p>
</div>
<div class="section level3">
<h3 id="refactor">Refactor<a class="anchor" aria-label="anchor" href="#refactor"></a></h3>
<p>At this point, our pytest function is just making sure we can import
the code. But our end-to-end test makes sure the entire function is
working as expected (albeit for a small, simple input). How about we
move the file IO into the main guard?</p>
<div id="refactor-1" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<div id="refactor-1" class="callout-inner">
<h3 class="callout-title">Refactor</h3>
<div class="callout-content">
<p>Change file IO to occur in the guard clause. Your new main method
should look like <code>def main(infile, outfile)</code>.</p>
</div>
</div>
</div>
<div id="accordionSolution1" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution1" aria-expanded="false" aria-controls="collapseSolution1">
  <h4 class="accordion-header" id="headingSolution1"> Show me the solution </h4>
</button>
<div id="collapseSolution1" class="accordion-collapse collapse" aria-labelledby="headingSolution1" data-bs-parent="#accordionSolution1">
<div class="accordion-body">
<div class="codewrapper sourceCode" id="cb4">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb4-1"><a href="#cb4-1" tabindex="-1"></a><span class="kw">def</span> main(infile, outfile):</span>
<span id="cb4-2"><a href="#cb4-2" tabindex="-1"></a>    ...</span>
<span id="cb4-3"><a href="#cb4-3" tabindex="-1"></a></span>
<span id="cb4-4"><a href="#cb4-4" tabindex="-1"></a><span class="cf">if</span> <span class="va">__name__</span> <span class="op">==</span> <span class="st">"__main__"</span>:</span>
<span id="cb4-5"><a href="#cb4-5" tabindex="-1"></a>    <span class="cf">with</span> <span class="bu">open</span>(sys.argv[<span class="dv">1</span>], encoding<span class="op">=</span><span class="st">'utf-8'</span>) <span class="im">as</span> infile, <span class="op">\</span></span>
<span id="cb4-6"><a href="#cb4-6" tabindex="-1"></a>            <span class="bu">open</span>(sys.argv[<span class="dv">2</span>], <span class="st">'w'</span>, encoding<span class="op">=</span><span class="st">'utf-8'</span>) <span class="im">as</span> outfile:</span>
<span id="cb4-7"><a href="#cb4-7" tabindex="-1"></a>        main(infile, outfile)</span></code></pre>
</div>
<p>That addresses the context manager and encoding of files. Continue to
run your tests to see your changes are ok!</p>
</div>
</div>
</div>
</div>
<p>After refactoring save the code as overlap_v1.py.</p>
</div>
</div>
<div class="section level2">
<h2 id="end-to-end-testing-with-pytest">End-to-end testing with pytest<a class="anchor" aria-label="anchor" href="#end-to-end-testing-with-pytest"></a></h2>
<p>We have a lot to address, but it would be nice to integrate our end
to end test with pytest so we can just run one command. The problem is
our main method deals with files. Reading and writing to a file system
can be several orders of magnitude slower than working in main memory.
We want our tests to be fast so we can run them all the time. The nice
thing about python’s duck typing is the infile and outfile variables
don’t have to be open files on disk, they can be in memory files. In
python, this is accomplished with a StringIO object from the io
library.</p>
<p>A StringIO object acts just like an open file. You can read and
iterate from it and you can write to it just like an opened text file.
When you want to read the contents, use the function
<code>getvalue</code> to get a string representation.</p>
<div class="section level3">
<h3 id="red-1">Red<a class="anchor" aria-label="anchor" href="#red-1"></a></h3>
<p>Let’s write a test that will pass in two StringIO objects, one with
the file to read and one for the output.</p>
<div class="codewrapper sourceCode" id="cb5">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb5-1"><a href="#cb5-1" tabindex="-1"></a><span class="co"># test_overlap.py</span></span>
<span id="cb5-2"><a href="#cb5-2" tabindex="-1"></a><span class="im">import</span> overlap_v1 <span class="im">as</span> overlap</span>
<span id="cb5-3"><a href="#cb5-3" tabindex="-1"></a><span class="im">from</span> io <span class="im">import</span> StringIO</span>
<span id="cb5-4"><a href="#cb5-4" tabindex="-1"></a></span>
<span id="cb5-5"><a href="#cb5-5" tabindex="-1"></a><span class="kw">def</span> test_end_to_end():</span>
<span id="cb5-6"><a href="#cb5-6" tabindex="-1"></a>    <span class="co">## ARRANGE</span></span>
<span id="cb5-7"><a href="#cb5-7" tabindex="-1"></a>    <span class="co"># initialize a StringIO with a string to read from</span></span>
<span id="cb5-8"><a href="#cb5-8" tabindex="-1"></a>    infile <span class="op">=</span> StringIO(</span>
<span id="cb5-9"><a href="#cb5-9" tabindex="-1"></a>        <span class="st">'a	0	0	2	2</span><span class="ch">\n</span><span class="st">'</span></span>
<span id="cb5-10"><a href="#cb5-10" tabindex="-1"></a>        <span class="st">'b	1	1	3	3</span><span class="ch">\n</span><span class="st">'</span></span>
<span id="cb5-11"><a href="#cb5-11" tabindex="-1"></a>        <span class="st">'c	10	10	11	11'</span></span>
<span id="cb5-12"><a href="#cb5-12" tabindex="-1"></a>    )</span>
<span id="cb5-13"><a href="#cb5-13" tabindex="-1"></a>    <span class="co"># this holds our output</span></span>
<span id="cb5-14"><a href="#cb5-14" tabindex="-1"></a>    outfile <span class="op">=</span> StringIO()</span>
<span id="cb5-15"><a href="#cb5-15" tabindex="-1"></a></span>
<span id="cb5-16"><a href="#cb5-16" tabindex="-1"></a>    <span class="co">## ACT</span></span>
<span id="cb5-17"><a href="#cb5-17" tabindex="-1"></a>    <span class="co"># call the function</span></span>
<span id="cb5-18"><a href="#cb5-18" tabindex="-1"></a>    overlap.main(infile, outfile)</span>
<span id="cb5-19"><a href="#cb5-19" tabindex="-1"></a></span>
<span id="cb5-20"><a href="#cb5-20" tabindex="-1"></a>    <span class="co">## ASSERT</span></span>
<span id="cb5-21"><a href="#cb5-21" tabindex="-1"></a>    output <span class="op">=</span> outfile.getvalue().split(<span class="st">'</span><span class="ch">\n</span><span class="st">'</span>)</span>
<span id="cb5-22"><a href="#cb5-22" tabindex="-1"></a>    <span class="cf">assert</span> output[<span class="dv">0</span>].split() <span class="op">==</span> <span class="st">'1 1 0'</span>.split()</span>
<span id="cb5-23"><a href="#cb5-23" tabindex="-1"></a>    <span class="cf">assert</span> output[<span class="dv">1</span>].split() <span class="op">==</span> <span class="st">'1 1 0'</span>.split()</span>
<span id="cb5-24"><a href="#cb5-24" tabindex="-1"></a>    <span class="cf">assert</span> output[<span class="dv">2</span>].split() <span class="op">==</span> <span class="st">'0 0 1'</span>.split()</span></code></pre>
</div>
<p>Since this is the first non-trivial test, let’s spend a moment going
over it. Like before we import our module and make our test function
start with <code>test_</code>. The actual name of the function is for
your benefit only so don’t be worried if it is “too long”. You won’t
have to type it so be descriptive! Next we have the three steps in all
tests: Arrange-Act-Assert (aka Given-When-Then)</p>
<ul><li>Arrange: Set up the state of the program in a particular way to test
the feature you want. Consider edge cases, mocking databases or files,
building helper objects, etc.</li>
<li>Act: Call the code you want to test</li>
<li>Assert: Confirm the observable outputs are what you expect
(i.e. compare the output with the expected output). Notice that the
outputs here read like the actual output file.</li>
</ul><p>Again, pytest uses plain assert statements to test results.</p>
<p>But we have a problem, our test passes! This is partially because we
are replacing an existing test, but the problem is how can you be sure
you are testing what you think? Maybe you are importing a different
version of code, maybe pytest isn’t finding your test, etc. Often a test
that passes which should fail is more worrisome than a test which fails
that should be passing.</p>
<p>Notice the splits in the assert section, they normalize the output so
any whitespace will be accepted. Let’s replace those with explicit white
space (tabs) and see if we can go red:</p>
<div class="codewrapper sourceCode" id="cb6">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb6-1"><a href="#cb6-1" tabindex="-1"></a>    <span class="cf">assert</span> output[<span class="dv">0</span>] <span class="op">==</span> <span class="st">'1</span><span class="ch">\t</span><span class="st">1</span><span class="ch">\t</span><span class="st">0'</span></span>
<span id="cb6-2"><a href="#cb6-2" tabindex="-1"></a>    <span class="cf">assert</span> output[<span class="dv">1</span>] <span class="op">==</span> <span class="st">'1</span><span class="ch">\t</span><span class="st">1</span><span class="ch">\t</span><span class="st">0'</span></span>
<span id="cb6-3"><a href="#cb6-3" tabindex="-1"></a>    <span class="cf">assert</span> output[<span class="dv">2</span>] <span class="op">==</span> <span class="st">'0</span><span class="ch">\t</span><span class="st">0</span><span class="ch">\t</span><span class="st">1'</span></span></code></pre>
</div>
<p>Since <code>split('\n')</code> strips off the newline at the end of
each line. Now we fail (yay!) and it’s due to something we have wanted
to change anyways. The pytest output says</p>
<div class="codewrapper sourceCode" id="cb7">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb7-1"><a href="#cb7-1" tabindex="-1"></a><span class="ex">E</span>       AssertionError: assert <span class="st">'1\t1\t0\t'</span> == <span class="st">'1\t1\t0'</span></span></code></pre>
</div>
<p>that is, we have an extra tab at the end of our lines.</p>
</div>
<div class="section level3">
<h3 id="green-1">Green<a class="anchor" aria-label="anchor" href="#green-1"></a></h3>
<div id="fix-the-code" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<div id="fix-the-code" class="callout-inner">
<h3 class="callout-title">Fix the code</h3>
<div class="callout-content">
<p>Change the overlap file to make the above test pass. Hint, change
when and where you write a tab to the file.</p>
</div>
</div>
</div>
<div id="accordionSolution2" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution2" aria-expanded="false" aria-controls="collapseSolution2">
  <h4 class="accordion-header" id="headingSolution2"> Show me the solution </h4>
</button>
<div id="collapseSolution2" class="accordion-collapse collapse" aria-labelledby="headingSolution2" data-bs-parent="#accordionSolution2">
<div class="accordion-body">
<p>There are a few options here. I’m opting for building a list and
using <code>join</code> for the heavy lifting.</p>
<div class="codewrapper sourceCode" id="cb8">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb8-1"><a href="#cb8-1" tabindex="-1"></a>   <span class="cf">for</span> red_name, red_coords <span class="kw">in</span> <span class="bu">dict</span>.items():</span>
<span id="cb8-2"><a href="#cb8-2" tabindex="-1"></a>       output_line <span class="op">=</span> []</span>
<span id="cb8-3"><a href="#cb8-3" tabindex="-1"></a>       <span class="cf">for</span> blue_name, blue_coords <span class="kw">in</span> <span class="bu">dict</span>.items():</span>
<span id="cb8-4"><a href="#cb8-4" tabindex="-1"></a>           <span class="co"># check if rects overlap</span></span>
<span id="cb8-5"><a href="#cb8-5" tabindex="-1"></a>           result <span class="op">=</span> <span class="st">'1'</span></span>
<span id="cb8-6"><a href="#cb8-6" tabindex="-1"></a></span>
<span id="cb8-7"><a href="#cb8-7" tabindex="-1"></a>           red_lo_x, red_lo_y, red_hi_x, red_hi_y <span class="op">=</span> red_coords</span>
<span id="cb8-8"><a href="#cb8-8" tabindex="-1"></a>           blue_lo_x, blue_lo_y, blue_hi_x, blue_hi_y <span class="op">=</span> blue_coords</span>
<span id="cb8-9"><a href="#cb8-9" tabindex="-1"></a></span>
<span id="cb8-10"><a href="#cb8-10" tabindex="-1"></a>           <span class="cf">if</span> (red_lo_x <span class="op">&gt;=</span> blue_hi_x) <span class="kw">or</span> (red_hi_x <span class="op">&lt;=</span> blue_lo_x) <span class="kw">or</span> <span class="op">\</span></span>
<span id="cb8-11"><a href="#cb8-11" tabindex="-1"></a>                   (red_lo_y <span class="op">&gt;=</span> blue_hi_x) <span class="kw">or</span> (red_hi_y <span class="op">&lt;=</span> blue_lo_y):</span>
<span id="cb8-12"><a href="#cb8-12" tabindex="-1"></a>               result <span class="op">=</span> <span class="st">'0'</span></span>
<span id="cb8-13"><a href="#cb8-13" tabindex="-1"></a></span>
<span id="cb8-14"><a href="#cb8-14" tabindex="-1"></a>           output_line.append(result)</span>
<span id="cb8-15"><a href="#cb8-15" tabindex="-1"></a>       outfile.write(<span class="st">'</span><span class="ch">\t</span><span class="st">'</span>.join(output_line) <span class="op">+</span> <span class="st">'</span><span class="ch">\n</span><span class="st">'</span>)</span></code></pre>
</div>
</div>
</div>
</div>
</div>
<p>Once you get the test passing you will notice that the
<code>end-to-end.sh</code> will no longer pass! One of the reasons to
test code is to find (and prevent) bugs. When you work on legacy code,
sometimes you will find bugs in published code and the questions can get
more problematic. Is the change something that will alter published
results? Was the previous version wrong or just not what you prefer? You
may decide to keep a bug if it was a valid answer! In this case we will
keep the change and not have a tab followed by a newline.</p>
</div>
<div class="section level3">
<h3 id="refactor-2">Refactor<a class="anchor" aria-label="anchor" href="#refactor-2"></a></h3>
<p>Let’s focus this round of refactoring on our test code and introduce
some nice pytest features. First, it seems like we will want to use our
simple input file in other tests. Instead of copying and pasting it
around, let’s extract it as a <em>fixture</em>. Pytest fixtures can do a
lot, but for now we just need a StringIO object built for some
tests:</p>
<div class="codewrapper sourceCode" id="cb9">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb9-1"><a href="#cb9-1" tabindex="-1"></a><span class="co"># test_overlap.py</span></span>
<span id="cb9-2"><a href="#cb9-2" tabindex="-1"></a><span class="im">import</span> overlap_v1 <span class="im">as</span> overlap</span>
<span id="cb9-3"><a href="#cb9-3" tabindex="-1"></a><span class="im">from</span> io <span class="im">import</span> StringIO</span>
<span id="cb9-4"><a href="#cb9-4" tabindex="-1"></a><span class="im">import</span> pytest</span>
<span id="cb9-5"><a href="#cb9-5" tabindex="-1"></a></span>
<span id="cb9-6"><a href="#cb9-6" tabindex="-1"></a><span class="at">@pytest.fixture</span>()</span>
<span id="cb9-7"><a href="#cb9-7" tabindex="-1"></a><span class="kw">def</span> simple_input():</span>
<span id="cb9-8"><a href="#cb9-8" tabindex="-1"></a>    <span class="cf">return</span> StringIO(</span>
<span id="cb9-9"><a href="#cb9-9" tabindex="-1"></a>        <span class="st">'a	0	0	2	2</span><span class="ch">\n</span><span class="st">'</span></span>
<span id="cb9-10"><a href="#cb9-10" tabindex="-1"></a>        <span class="st">'b	1	1	3	3</span><span class="ch">\n</span><span class="st">'</span></span>
<span id="cb9-11"><a href="#cb9-11" tabindex="-1"></a>        <span class="st">'c	10	10	11	11'</span></span>
<span id="cb9-12"><a href="#cb9-12" tabindex="-1"></a>    )</span>
<span id="cb9-13"><a href="#cb9-13" tabindex="-1"></a></span>
<span id="cb9-14"><a href="#cb9-14" tabindex="-1"></a><span class="kw">def</span> test_end_to_end(simple_input):</span>
<span id="cb9-15"><a href="#cb9-15" tabindex="-1"></a>    <span class="co"># initialize a StringIO with a string to read from</span></span>
<span id="cb9-16"><a href="#cb9-16" tabindex="-1"></a>    infile <span class="op">=</span> simple_input</span>
<span id="cb9-17"><a href="#cb9-17" tabindex="-1"></a>    ...</span></code></pre>
</div>
<p>We start by importing pytest so we can use the
<code>@pytest.fixture()</code> decorator. This decorates a function and
makes its return value available to any function that uses it as an
input argument. Next we can replace our <code>infile</code> definition
by assigning it to <code>simple_input</code> in
<code>test_end_to_end</code>.</p>
<p>For this code, the end-to-end test runs quickly, but what if it took
several minutes? Ideally we could run our fast tests all the time and
occasionally run everything, including slow tests. The simplest way to
achieve this with pytest is to mark the function as slow and invoke
pytest with <code>pytest -m "not slow"</code>:</p>
<div class="codewrapper sourceCode" id="cb10">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb10-1"><a href="#cb10-1" tabindex="-1"></a><span class="co"># test_overlap.py</span></span>
<span id="cb10-2"><a href="#cb10-2" tabindex="-1"></a><span class="at">@pytest.mark.slow</span>()</span>
<span id="cb10-3"><a href="#cb10-3" tabindex="-1"></a><span class="kw">def</span> test_end_to_end(simple_input):</span>
<span id="cb10-4"><a href="#cb10-4" tabindex="-1"></a>    ...</span></code></pre>
</div>
<div class="codewrapper sourceCode" id="cb11">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb11-1"><a href="#cb11-1" tabindex="-1"></a><span class="ex">pytest</span> <span class="at">-m</span> <span class="st">"not slow"</span> test_overlap.py</span>
<span id="cb11-2"><a href="#cb11-2" tabindex="-1"></a><span class="ex">==========================================</span> test session starts ===========================================</span>
<span id="cb11-3"><a href="#cb11-3" tabindex="-1"></a><span class="ex">platform</span> linux <span class="at">--</span> Python 3.9.16, pytest-7.3.1, pluggy-1.0.0</span>
<span id="cb11-4"><a href="#cb11-4" tabindex="-1"></a><span class="ex">rootdir:</span> ~/projects/testing-lesson/files</span>
<span id="cb11-5"><a href="#cb11-5" tabindex="-1"></a><span class="ex">plugins:</span> anyio-3.6.2</span>
<span id="cb11-6"><a href="#cb11-6" tabindex="-1"></a><span class="ex">collected</span> 1 item / 1 deselected / 0 selected</span></code></pre>
</div>
<p>Note that the one test was deselected and not run. You can (and
should) formalize this mark as described in the warning that will pop
up!</p>
<div id="keypoints1" class="callout keypoints">
<div class="callout-square">
<i class="callout-icon" data-feather="key"></i>
</div>
<div class="callout-inner">
<h3 class="callout-title">Key Points</h3>
<div class="callout-content">
<ul><li>TDD cycles between the phases red, green, and refactor</li>
<li>TDD cycles should be fast, run tests on every write</li>
<li>Writing tests first ensures you <em>have</em> tests and that they
are working</li>
<li>Making code testable forces better style</li>
<li>It is much faster to work with code under test</li>
</ul></div>
</div>
</div>
<!--
Place links that you need to refer to multiple times across pages here. Delete
any links that you are not going to use.
 -->
</div>
</div>
</div>



      </div> <!-- / div.lesson-content -->
    </main><!-- / main#main-content.main-content --><nav class="bottom-pagination mx-md-4" aria-label="Previous and Next Chapter"><div class="d-block d-sm-block d-md-none">
        <a class="chapter-link" href="../instructor/test-framework-code-cov.html"><i aria-hidden="true" class="small-arrow" data-feather="arrow-left"></i>Previous</a>
        <a class="chapter-link float-end" href="../instructor/refactor-for-testing.html">Next<i aria-hidden="true" class="small-arrow" data-feather="arrow-right"></i></a>
      </div>
      <!-- content for large screens -->
      <div class="d-none d-sm-none d-md-block">
        <a class="chapter-link" href="../instructor/test-framework-code-cov.html" rel="prev">
          <i aria-hidden="true" class="small-arrow" data-feather="arrow-left"></i>
          Previous: Test framework
        </a>
        <a class="chapter-link float-end" href="../instructor/refactor-for-testing.html" rel="next">
          Next: Refactoring for...
          <i aria-hidden="true" class="small-arrow" data-feather="arrow-right"></i>
        </a>
      </div>
    </nav></div> <!-- / div.primary-content.col-xs-12 -->
<!-- END:   inst/pkgdown/templates/content-instructor.html-->

      </div><!--/div.row-->
      		<footer class="row footer mx-md-3"><hr><div class="col-md-6">
        <p>This lesson is subject to the <a href="CODE_OF_CONDUCT.html">Code of Conduct</a></p>
        <p>

        <a href="https://github.com/INTERSECT-training/testing-lesson/edit/main/episodes/TDD.md" class="external-link">Edit on GitHub</a>

	
        | <a href="https://github.com/INTERSECT-training/testing-lesson/blob/main/CONTRIBUTING.md" class="external-link">Contributing</a>
        | <a href="https://github.com/INTERSECT-training/testing-lesson/" class="external-link">Source</a></p>
				<p><a href="https://github.com/INTERSECT-training/testing-lesson/blob/main/CITATION.cff" class="external-link">Cite</a> | <a href="mailto:icosden@princeton.edu">Contact</a> | <a href="https://carpentries.org/about/" class="external-link">About</a></p>
			</div>
			<div class="col-md-6">

        <p>Materials licensed under <a href="LICENSE.html">CC-BY 4.0</a> by the authors</p>

        <p>Template licensed under <a href="https://creativecommons.org/licenses/by-sa/4.0/" class="external-link">CC-BY 4.0</a> by <a href="https://carpentries.org/" class="external-link">The Carpentries</a></p>
        <p>Built with <a href="https://github.com/carpentries/sandpaper/tree/0.16.12" class="external-link">sandpaper (0.16.12)</a>, <a href="https://github.com/carpentries/pegboard/tree/0.7.9" class="external-link">pegboard (0.7.9)</a>, and <a href="https://github.com/intersect-training/varnish/tree/406bb97bab56e8a0c29f2f362164c5d4a05b7ee1" class="external-link">varnish (1.0.7.9000)</a></p>
			</div>
		</footer></div> <!-- / div.container -->
	<div id="to-top">
		<a href="#top">
      <i class="search-icon" data-feather="arrow-up" role="img" aria-label="Back To Top"></i><br><!-- <span class="d-none d-sm-none d-md-none d-lg-none d-xl-block">Back</span> To Top --><span class="d-none d-sm-none d-md-none d-lg-none d-xl-block">Back</span> To Top
		</a>
	</div>
  <script type="application/ld+json">
    {
  "@context": "https://schema.org",
  "@type": "LearningResource",
  "@id": "https://INTERSECT-training.github.io/testing-lesson/instructor/TDD.html",
  "inLanguage": "en",
  "dct:conformsTo": "https://bioschemas.org/profiles/LearningResource/1.0-RELEASE",
  "description": "A Carpentries Lesson teaching foundational data and coding skills to researchers worldwide",
  "keywords": "software, data, lesson, The Carpentries",
  "name": "Test Driven Development",
  "creativeWorkStatus": "active",
  "url": "https://INTERSECT-training.github.io/testing-lesson/instructor/TDD.html",
  "identifier": "https://INTERSECT-training.github.io/testing-lesson/instructor/TDD.html",
  "dateCreated": "2025-05-21",
  "dateModified": "2025-05-21",
  "datePublished": "2025-06-03"
}

  </script><script>
		feather.replace();
	</script></body></html><!-- END:   inst/pkgdown/templates/layout.html-->

