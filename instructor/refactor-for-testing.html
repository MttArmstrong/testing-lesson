<!DOCTYPE html>
<!-- START: inst/pkgdown/templates/layout.html --><!-- Generated by pkgdown: do not edit by hand --><html lang="en" data-bs-theme="auto"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><title>Testing: Refactoring for Testing</title><meta name="viewport" content="width=device-width, initial-scale=1"><script src="../assets/themetoggle.js"></script><link rel="stylesheet" type="text/css" href="../assets/styles.css"><script src="../assets/scripts.js" type="text/javascript"></script><!-- mathjax --><script type="text/x-mathjax-config">
    MathJax.Hub.Config({
      config: ["MMLorHTML.js"],
      jax: ["input/TeX","input/MathML","output/HTML-CSS","output/NativeMML", "output/PreviewHTML"],
      extensions: ["tex2jax.js","mml2jax.js","MathMenu.js","MathZoom.js", "fast-preview.js", "AssistiveMML.js", "a11y/accessibility-menu.js"],
      TeX: {
        extensions: ["AMSmath.js","AMSsymbols.js","noErrors.js","noUndefined.js"]
      },
      tex2jax: {
        inlineMath: [['\\(', '\\)']],
        displayMath: [ ['$$','$$'], ['\\[', '\\]'] ],
        processEscapes: true
      }
    });
    </script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><!-- Responsive Favicon for The Carpentries --><link rel="apple-touch-icon" sizes="180x180" href="../favicons/intersect/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="../favicons/intersect/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="../favicons/intersect/favicon-16x16.png"><link rel="manifest" href="../favicons/intersect/site.webmanifest"><link rel="mask-icon" href="../favicons/intersect/safari-pinned-tab.svg" color="#5bbad5"><meta name="msapplication-TileColor" content="#da532c"><meta name="theme-color" media="(prefers-color-scheme: light)" content="white"><meta name="theme-color" media="(prefers-color-scheme: dark)" content="black"></head><body>
    <header id="top" class="navbar navbar-expand-md top-nav intersect"><svg xmlns="http://www.w3.org/2000/svg" class="d-none"><symbol id="check2" viewbox="0 0 16 16"><path d="M13.854 3.646a.5.5 0 0 1 0 .708l-7 7a.5.5 0 0 1-.708 0l-3.5-3.5a.5.5 0 1 1 .708-.708L6.5 10.293l6.646-6.647a.5.5 0 0 1 .708 0z"></path></symbol><symbol id="circle-half" viewbox="0 0 16 16"><path d="M8 15A7 7 0 1 0 8 1v14zm0 1A8 8 0 1 1 8 0a8 8 0 0 1 0 16z"></path></symbol><symbol id="moon-stars-fill" viewbox="0 0 16 16"><path d="M6 .278a.768.768 0 0 1 .08.858 7.208 7.208 0 0 0-.878 3.46c0 4.021 3.278 7.277 7.318 7.277.527 0 1.04-.055 1.533-.16a.787.787 0 0 1 .81.316.733.733 0 0 1-.031.893A8.349 8.349 0 0 1 8.344 16C3.734 16 0 12.286 0 7.71 0 4.266 2.114 1.312 5.124.06A.752.752 0 0 1 6 .278z"></path><path d="M10.794 3.148a.217.217 0 0 1 .412 0l.387 1.162c.173.518.579.924 1.097 1.097l1.162.387a.217.217 0 0 1 0 .412l-1.162.387a1.734 1.734 0 0 0-1.097 1.097l-.387 1.162a.217.217 0 0 1-.412 0l-.387-1.162A1.734 1.734 0 0 0 9.31 6.593l-1.162-.387a.217.217 0 0 1 0-.412l1.162-.387a1.734 1.734 0 0 0 1.097-1.097l.387-1.162zM13.863.099a.145.145 0 0 1 .274 0l.258.774c.115.346.386.617.732.732l.774.258a.145.145 0 0 1 0 .274l-.774.258a1.156 1.156 0 0 0-.732.732l-.258.774a.145.145 0 0 1-.274 0l-.258-.774a1.156 1.156 0 0 0-.732-.732l-.774-.258a.145.145 0 0 1 0-.274l.774-.258c.346-.115.617-.386.732-.732L13.863.1z"></path></symbol><symbol id="sun-fill" viewbox="0 0 16 16"><path d="M8 12a4 4 0 1 0 0-8 4 4 0 0 0 0 8zM8 0a.5.5 0 0 1 .5.5v2a.5.5 0 0 1-1 0v-2A.5.5 0 0 1 8 0zm0 13a.5.5 0 0 1 .5.5v2a.5.5 0 0 1-1 0v-2A.5.5 0 0 1 8 13zm8-5a.5.5 0 0 1-.5.5h-2a.5.5 0 0 1 0-1h2a.5.5 0 0 1 .5.5zM3 8a.5.5 0 0 1-.5.5h-2a.5.5 0 0 1 0-1h2A.5.5 0 0 1 3 8zm10.657-5.657a.5.5 0 0 1 0 .707l-1.414 1.415a.5.5 0 1 1-.707-.708l1.414-1.414a.5.5 0 0 1 .707 0zm-9.193 9.193a.5.5 0 0 1 0 .707L3.05 13.657a.5.5 0 0 1-.707-.707l1.414-1.414a.5.5 0 0 1 .707 0zm9.193 2.121a.5.5 0 0 1-.707 0l-1.414-1.414a.5.5 0 0 1 .707-.707l1.414 1.414a.5.5 0 0 1 0 .707zM4.464 4.465a.5.5 0 0 1-.707 0L2.343 3.05a.5.5 0 1 1 .707-.707l1.414 1.414a.5.5 0 0 1 0 .708z"></path></symbol></svg><a class="visually-hidden-focusable skip-link" href="#main-content">Skip to main content</a>
  <div class="container-fluid top-nav-container">
    <div class="col-md-8">
      <div class="large-logo">
        <img id="intersect-logo" alt="Lesson on testing" src="../assets/images/intersect-logo.svg"><span class="badge text-bg-info">
          <abbr title="This lesson is in the beta phase, which means that it is ready for teaching by instructors outside of the original author team.">
            <a href="https://docs.carpentries.org/resources/curriculum/lesson-life-cycle.html" class="external-link alert-link">
              <i aria-hidden="true" class="icon" data-feather="alert-circle" style="border-radius: 5px"></i>
              Beta
            </a>
            <span class="visually-hidden">This lesson is in the beta phase, which means that it is ready for teaching by instructors outside of the original author team.</span>
          </abbr>
        </span>

      </div>
    </div>
    <div class="selector-container">
      <div id="theme-selector">
        <li class="nav-item dropdown" id="theme-button-list">
          <button class="btn btn-link nav-link px-0 px-lg-2 dropdown-toggle d-flex align-items-center" id="bd-theme" type="button" aria-expanded="false" data-bs-toggle="dropdown" data-bs-display="static" aria-label="Toggle theme (auto)">
            <svg class="bi my-1 theme-icon-active"><use href="#circle-half"></use></svg><i data-feather="chevron-down"></i>
          </button>
          <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="bd-theme-text"><li>
              <button type="button" class="btn dropdown-item d-flex align-items-center" data-bs-theme-value="light" aria-pressed="false">
                <svg class="bi me-2 theme-icon"><use href="#sun-fill"></use></svg>
                Light
                <svg class="bi ms-auto d-none"><use href="#check2"></use></svg></button>
            </li>
            <li>
              <button type="button" class="btn dropdown-item d-flex align-items-center" data-bs-theme-value="dark" aria-pressed="false">
                <svg class="bi me-2 theme-icon"><use href="#moon-stars-fill"></use></svg>
                Dark
                <svg class="bi ms-auto d-none"><use href="#check2"></use></svg></button>
            </li>
            <li>
              <button type="button" class="btn dropdown-item d-flex align-items-center active" data-bs-theme-value="auto" aria-pressed="true">
                <svg class="bi me-2 theme-icon"><use href="#circle-half"></use></svg>
                Auto
                <svg class="bi ms-auto d-none"><use href="#check2"></use></svg></button>
            </li>
          </ul></li>
      </div>

      <div class="dropdown" id="instructor-dropdown">
        <button class="btn btn-secondary dropdown-toggle bordered-button" type="button" id="dropdownMenu1" data-bs-toggle="dropdown" aria-expanded="false">
          <i aria-hidden="true" class="icon" data-feather="eye"></i> Instructor View <i data-feather="chevron-down"></i>
        </button>
        <ul class="dropdown-menu" aria-labelledby="dropdownMenu1"><li><button class="dropdown-item" type="button" onclick="window.location.href='../refactor-for-testing.html';">Learner View</button></li>
        </ul></div>
    </div>
  </div>
  <hr></header><nav class="navbar navbar-expand-xl bottom-nav intersect" aria-label="Main Navigation"><div class="container-fluid nav-container">
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle Navigation">
      <span class="navbar-toggler-icon"></span>
      <span class="menu-title">Menu</span>
    </button>
    <div class="nav-logo">
      <img class="small-logo" alt="Lesson on testing" src="../assets/images/intersect-logo-sm.svg"></div>
    <div class="lesson-title-md">
      Testing
    </div>
    <div class="search-icon-sm">
      <!-- TODO: do not show until we have search
        <i role="img" aria-label="Search the All In One page" data-feather="search"></i>
      -->
    </div>
    <div class="desktop-nav">
      <ul class="navbar-nav me-auto mb-2 mb-lg-0"><li class="nav-item">
          <span class="lesson-title">
            Testing
          </span>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="../instructor/key-points.html">Key Points</a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="../instructor/instructor-notes.html">Instructor Notes</a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="../instructor/images.html">Extract All Images</a>
        </li>
        <li class="nav-item dropdown">
          <button class="nav-link dropdown-toggle" id="navbarDropdown" data-bs-toggle="dropdown" aria-expanded="false">
            More <i data-feather="chevron-down"></i>
          </button>
          <ul class="dropdown-menu" aria-labelledby="navbarDropdown"><hr><li><a class="dropdown-item" href="reference.html">Reference</a></li>
          </ul></li>
      </ul></div>
    <!--
    <form class="d-flex col-md-2 search-form">
      <fieldset disabled>
      <input class="form-control me-2 searchbox" type="search" placeholder="" aria-label="">
        <button class="btn btn-outline-success tablet-search-button"  type="submit">
          <i class="search-icon" data-feather="search" role="img" aria-label="Search the All In One page"></i>
        </button>
      </fieldset>
    </form>
    -->
    <a id="search-button" class="btn btn-primary" href="../instructor/aio.html" role="button" aria-label="Search the All In One page">Search the All In One page</a>
  </div><!--/div.container-fluid -->
</nav><div class="col-md-12 mobile-title">
  Testing
</div>

<aside class="col-md-12 lesson-progress"><div style="width: 47%" class="percentage">
    47%
  </div>
  <div class="progress intersect">
    <div class="progress-bar intersect" role="progressbar" style="width: 47%" aria-valuenow="47" aria-label="Lesson Progress" aria-valuemin="0" aria-valuemax="100">
    </div>
  </div>
</aside><div class="container">
      <div class="row">
        <!-- START: inst/pkgdown/templates/navbar.html -->
<div id="sidebar-col" class="col-lg-4">
  <div id="sidebar" class="sidebar">
      <nav aria-labelledby="flush-headingEleven"><button role="button" aria-label="close menu" alt="close menu" aria-expanded="true" aria-controls="sidebar" class="collapse-toggle" data-collapse="Collapse " data-episodes="Episodes ">
          <i class="search-icon" data-feather="x" role="img"></i>
        </button>
        <div class="sidebar-inner">
          <div class="row mobile-row" id="theme-row-mobile">
            <div class="col" id="theme-selector">
              <li class="nav-item dropdown" id="theme-button-list">
                <button class="btn btn-link nav-link px-0 px-lg-2 dropdown-toggle d-flex align-items-center" id="bd-theme" type="button" aria-expanded="false" data-bs-toggle="dropdown" data-bs-display="static" aria-label="Toggle theme (auto)">
                  <svg class="bi my-1 theme-icon-active"><use href="#circle-half"></use></svg><span class="d-lg-none ms-1" id="bd-theme-text">Toggle Theme</span>
                </button>
                <ul class="dropdown-menu dropdown-menu-right" aria-labelledby="bd-theme-text"><li>
                    <button type="button" class="btn dropdown-item d-flex align-items-center" data-bs-theme-value="light" aria-pressed="false">
                      <svg class="bi me-2 theme-icon"><use href="#sun-fill"></use></svg>
                      Light
                      <svg class="bi ms-auto d-none"><use href="#check2"></use></svg></button>
                  </li>
                  <li>
                    <button type="button" class="btn dropdown-item d-flex align-items-center" data-bs-theme-value="dark" aria-pressed="false">
                      <svg class="bi me-2 theme-icon"><use href="#moon-stars-fill"></use></svg>
                      Dark
                      <svg class="bi ms-auto d-none"><use href="#check2"></use></svg></button>
                  </li>
                  <li>
                    <button type="button" class="btn dropdown-item d-flex align-items-center active" data-bs-theme-value="auto" aria-pressed="true">
                      <svg class="bi me-2 theme-icon"><use href="#circle-half"></use></svg>
                      Auto
                      <svg class="bi ms-auto d-none"><use href="#check2"></use></svg></button>
                  </li>
                </ul></li>
            </div>
          </div>
          <div class="row mobile-row">
            <div class="col">
              <div class="sidenav-view-selector">
                <div class="accordion accordion-flush" id="accordionFlush9">
                  <div class="accordion-item">
                    <h2 class="accordion-header" id="flush-headingNine">
                      <button class="accordion-button collapsed" id="instructor" type="button" data-bs-toggle="collapse" data-bs-target="#flush-collapseNine" aria-expanded="false" aria-controls="flush-collapseNine">
                        <i id="eye" aria-hidden="true" class="icon" data-feather="eye"></i> Instructor View
                      </button>
                    </h2>
                    <div id="flush-collapseNine" class="accordion-collapse collapse" aria-labelledby="flush-headingNine" data-bs-parent="#accordionFlush2">
                      <div class="accordion-body">
                        <a href="../refactor-for-testing.html">Learner View</a>
                      </div>
                    </div>
                  </div><!--/div.accordion-item-->
                </div><!--/div.accordion-flush-->
              </div><!--div.sidenav-view-selector -->
            </div><!--/div.col -->

            <hr></div><!--/div.mobile-row -->

          <div class="accordion accordion-flush" id="accordionFlush11">
            <div class="accordion-item">

              <button id="chapters" class="accordion-button show" type="button" data-bs-toggle="collapse" data-bs-target="#flush-collapseEleven" aria-expanded="false" aria-controls="flush-collapseEleven">
                <h2 class="accordion-header chapters" id="flush-headingEleven">
                  EPISODES
                </h2>
              </button>
              <div id="flush-collapseEleven" class="accordion-collapse show collapse" aria-labelledby="flush-headingEleven" data-bs-parent="#accordionFlush11">

                <div class="accordion-body">
                  <div class="accordion accordion-flush" id="accordionFlush1">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading1">
        <a href="index.html">Summary and Schedule</a>
    </div><!--/div.accordion-header-->

  </div><!--/div.accordion-item-->
</div><!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush2">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading2">
        <a href="introduction.html">1. Introduction</a>
    </div><!--/div.accordion-header-->

  </div><!--/div.accordion-item-->
</div><!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush3">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading3">
        <a href="legacy-codebase.html">2. Working with Legacy Code</a>
    </div><!--/div.accordion-header-->

  </div><!--/div.accordion-item-->
</div><!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush4">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading4">
        <a href="test-framework-code-cov.html">3. Test framework</a>
    </div><!--/div.accordion-header-->

  </div><!--/div.accordion-item-->
</div><!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush5">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading5">
        <a href="TDD.html">4. Test Driven Development</a>
    </div><!--/div.accordion-header-->

  </div><!--/div.accordion-item-->
</div><!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlushcurrent">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-headingcurrent">
        <span class="visually-hidden">Current Chapter</span>
        <span class="current-chapter">
        5. Refactoring for Testing
        </span>
      
    </div><!--/div.accordion-header-->

  </div><!--/div.accordion-item-->
</div><!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush7">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading7">
        <a href="big-changes.html">6. Testing Big Changes</a>
    </div><!--/div.accordion-header-->

  </div><!--/div.accordion-item-->
</div><!--/div.accordion-flush-->

                </div>
              </div>
            </div>

            <hr class="half-width"><div class="accordion accordion-flush lesson-resources" id="accordionFlush12">
              <div class="accordion-item">
                <h2 class="accordion-header" id="flush-headingTwelve">
                  <button class="accordion-button collapsed" id="lesson-resources" type="button" data-bs-toggle="collapse" data-bs-target="#flush-collapseTwelve" aria-expanded="false" aria-controls="flush-collapseTwelve">
                    RESOURCES
                  </button>
                </h2>
                <div id="flush-collapseTwelve" class="accordion-collapse collapse" aria-labelledby="flush-headingTwelve" data-bs-parent="#accordionFlush12">
                  <div class="accordion-body">
                    <ul><li>
                        <a href="../instructor/key-points.html">Key Points</a>
                      </li>
                      <li>
                        <a href="../instructor/instructor-notes.html">Instructor Notes</a>
                      </li>
                      <li>
                        <a href="../instructor/images.html">Extract All Images</a>
                      </li>
                      <hr><li><a class="dropdown-item" href="reference.html">Reference</a></li>
                    </ul></div>
                </div>
              </div>
            </div>
            <hr class="half-width lesson-resources"><a href="../instructor/aio.html">See all in one page</a>


            <hr class="d-none d-sm-block d-md-none"><div class="d-grid gap-1">

            </div>
          </div><!-- /div.accordion -->
        </div><!-- /div.sidebar-inner -->
      </nav></div><!-- /div.sidebar -->
  </div><!-- /div.sidebar-col -->
<!-- END:   inst/pkgdown/templates/navbar.html-->

        <!-- START: inst/pkgdown/templates/content-instructor.html -->
  <div class="col-xl-8 col-lg-12 primary-content">
    <nav class="lesson-content mx-md-4" aria-label="Previous and Next Chapter"><!-- content for small screens --><div class="d-block d-sm-block d-md-none">
        <a class="chapter-link" href="../instructor/TDD.html"><i aria-hidden="true" class="small-arrow" data-feather="arrow-left"></i>Previous</a>
        <a class="chapter-link float-end" href="../instructor/big-changes.html">Next<i aria-hidden="true" class="small-arrow" data-feather="arrow-right"></i></a>
      </div>
      <!-- content for large screens -->
      <div class="d-none d-sm-none d-md-block">
        <a class="chapter-link" href="../instructor/TDD.html" rel="prev">
          <i aria-hidden="true" class="small-arrow" data-feather="arrow-left"></i>
          Previous: Test Driven
        </a>
        <a class="chapter-link float-end" href="../instructor/big-changes.html" rel="next">
          Next: Testing Big Changes...
          <i aria-hidden="true" class="small-arrow" data-feather="arrow-right"></i>
        </a>
      </div>
      <hr></nav><main id="main-content" class="main-content"><div class="container lesson-content">
        <h1>Refactoring for Testing</h1>
        <p>Last updated on 2025-05-21 |

        <a href="https://github.com/INTERSECT-training/testing-lesson/edit/main/episodes/refactor-for-testing.md" class="external-link">Edit this page <i aria-hidden="true" data-feather="edit"></i></a></p>



        <p>Estimated time: <i aria-hidden="true" data-feather="clock"></i> 60 minutes</p>

        <div class="text-end">
          <button role="button" aria-pressed="false" tabindex="0" id="expand-code" class="pull-right" data-expand="Expand All Solutions " data-collapse="Collapse All Solutions "> Expand All Solutions <i aria-hidden="true" data-feather="plus"></i></button>
        </div>

        

<div class="overview card">
<h2 class="card-header">Overview</h2>
<div class="row g-0">
<div class="col-md-4">
<div class="card-body">
<div class="inner">
<h3 class="card-title">Questions</h3>
<ul><li>Why are long methods hard to test?</li>
</ul></div>
</div>
</div>
<div class="col-md-8">
<div class="card-body">
<div class="inner bordered">
<h3 class="card-title">Objectives</h3>
<ul><li>Learn some key refactoring methods to change code safely.</li>
<li>Modify the overlap script to support a Rectangle object.</li>
</ul></div>
</div>
</div>
</div>
</div>
<div class="section level1">
<h1 id="monolithic-main-methods">Monolithic Main Methods<a class="anchor" aria-label="anchor" href="#monolithic-main-methods"></a></h1>
<p>One of the smelliest code smells that new developers make is having a
single main method which spans several hundred (thousand?) lines. Even
if the code is perfect, long methods are an anti-pattern because they
require a reader of the code to have exceptionally good working memory
to understand the method. It also becomes impossible to reuse part of
the code elsewhere.</p>
<p>Consider the following two sections of code:</p>
<div class="codewrapper sourceCode" id="cb1">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1" tabindex="-1"></a><span class="cf">if</span> user <span class="kw">is</span> <span class="kw">not</span> <span class="va">None</span> <span class="kw">and</span> user <span class="kw">in</span> database <span class="kw">and</span> database[user][<span class="st">'type'</span>] <span class="op">==</span> <span class="st">'admin'</span>:</span>
<span id="cb1-2"><a href="#cb1-2" tabindex="-1"></a>    <span class="co"># do admin work</span></span>
<span id="cb1-3"><a href="#cb1-3" tabindex="-1"></a></span>
<span id="cb1-4"><a href="#cb1-4" tabindex="-1"></a><span class="co">#### vs ####</span></span>
<span id="cb1-5"><a href="#cb1-5" tabindex="-1"></a><span class="kw">def</span> user_is_admin(user, database):</span>
<span id="cb1-6"><a href="#cb1-6" tabindex="-1"></a>    <span class="cf">return</span> user <span class="kw">is</span> <span class="kw">not</span> <span class="va">None</span> <span class="kw">and</span> user <span class="kw">in</span> database <span class="kw">and</span> database[user][<span class="st">'type'</span>] <span class="op">==</span> <span class="st">'admin'</span></span>
<span id="cb1-7"><a href="#cb1-7" tabindex="-1"></a></span>
<span id="cb1-8"><a href="#cb1-8" tabindex="-1"></a><span class="cf">if</span> user_is_admin(user, database):</span>
<span id="cb1-9"><a href="#cb1-9" tabindex="-1"></a>    <span class="co"># do admin work</span></span></code></pre>
</div>
<p>The second version puts less stress on the reader because when they
see the function called <code>user_is_admin</code> they can treat it
like a black box until they are interested in the internals. But we are
here to talk about testing!</p>
<p>Consider writing a test for the first version, where all the logic of
what makes a user an admin is in the if statement. To even get to this
line of code you will have to set up your system and possibly mock or
replace other function calls. As a separate function, your test becomes
a unit test, exercising a small piece of code. Here is a possible
pytest:</p>
<div class="codewrapper sourceCode" id="cb2">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb2-1"><a href="#cb2-1" tabindex="-1"></a><span class="kw">def</span> test_user_is_admin():</span>
<span id="cb2-2"><a href="#cb2-2" tabindex="-1"></a>    user <span class="op">=</span> <span class="va">None</span></span>
<span id="cb2-3"><a href="#cb2-3" tabindex="-1"></a>    database <span class="op">=</span> {}</span>
<span id="cb2-4"><a href="#cb2-4" tabindex="-1"></a>    <span class="cf">assert</span> user_is_admin(user, database) <span class="kw">is</span> <span class="va">False</span>, <span class="st">"None user is not an admin"</span></span>
<span id="cb2-5"><a href="#cb2-5" tabindex="-1"></a></span>
<span id="cb2-6"><a href="#cb2-6" tabindex="-1"></a>    user <span class="op">=</span> <span class="st">"Jim"</span></span>
<span id="cb2-7"><a href="#cb2-7" tabindex="-1"></a>    database <span class="op">=</span> {}</span>
<span id="cb2-8"><a href="#cb2-8" tabindex="-1"></a>    <span class="cf">assert</span> user_is_admin(user, database) <span class="kw">is</span> <span class="va">False</span>, <span class="st">"User not in database"</span></span>
<span id="cb2-9"><a href="#cb2-9" tabindex="-1"></a></span>
<span id="cb2-10"><a href="#cb2-10" tabindex="-1"></a>    database <span class="op">=</span> {<span class="st">"Jim"</span>: {<span class="st">"type"</span>: <span class="st">"regular"</span>}}</span>
<span id="cb2-11"><a href="#cb2-11" tabindex="-1"></a>    <span class="cf">assert</span> user_is_admin(user, database) <span class="kw">is</span> <span class="va">False</span>, <span class="st">"User is not an admin"</span></span>
<span id="cb2-12"><a href="#cb2-12" tabindex="-1"></a></span>
<span id="cb2-13"><a href="#cb2-13" tabindex="-1"></a>    database <span class="op">=</span> {<span class="st">"Jim"</span>: {<span class="st">"type"</span>: <span class="st">"admin"</span>}}</span>
<span id="cb2-14"><a href="#cb2-14" tabindex="-1"></a>    <span class="cf">assert</span> user_is_admin(user, database) <span class="kw">is</span> <span class="va">True</span>, <span class="st">"User is an admin"</span></span></code></pre>
</div>
<p>A surprising benefit of TDD and testing is that having to write code
with tests makes your code better! It’s just too hard to write tests for
bad code; if you <em>have</em> to write a test then it’s easier to just
write better code.</p>
</div>
<div class="section level1">
<h1 id="safe-refactoring-and-tdd">Safe Refactoring and TDD<a class="anchor" aria-label="anchor" href="#safe-refactoring-and-tdd"></a></h1>
<div class="section level2">
<h2 id="reading-in-rectangles">Reading in Rectangles<a class="anchor" aria-label="anchor" href="#reading-in-rectangles"></a></h2>
<p>Now back to our overlap code. You have inherited a monolithic main
method, how do you go about breaking it up? Some IDEs have functions for
extracting a method or attribute but we are following TDD and need to
write a failing test first. Let’s start with the first portion of our
existing main method, reading in the <code>dict</code>:</p>
<div class="section level3">
<h3 id="red">Red<a class="anchor" aria-label="anchor" href="#red"></a></h3>
<div class="codewrapper sourceCode" id="cb3">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb3-1"><a href="#cb3-1" tabindex="-1"></a><span class="co"># overlap.py</span></span>
<span id="cb3-2"><a href="#cb3-2" tabindex="-1"></a></span>
<span id="cb3-3"><a href="#cb3-3" tabindex="-1"></a><span class="kw">def</span> main(infile, outfile):</span>
<span id="cb3-4"><a href="#cb3-4" tabindex="-1"></a>    <span class="co"># build rectangle struct</span></span>
<span id="cb3-5"><a href="#cb3-5" tabindex="-1"></a>    <span class="bu">dict</span> <span class="op">=</span> {}</span>
<span id="cb3-6"><a href="#cb3-6" tabindex="-1"></a>    <span class="cf">for</span> line <span class="kw">in</span> infile:</span>
<span id="cb3-7"><a href="#cb3-7" tabindex="-1"></a>        name, <span class="op">*</span>coords <span class="op">=</span> line.split()</span>
<span id="cb3-8"><a href="#cb3-8" tabindex="-1"></a>        <span class="bu">dict</span>[name] <span class="op">=</span> [<span class="bu">int</span>(c) <span class="cf">for</span> c <span class="kw">in</span> coords]</span>
<span id="cb3-9"><a href="#cb3-9" tabindex="-1"></a>...</span></code></pre>
</div>
<p>We have a design decision to make. Should we extract the entire for
loop or just the inside? The current code works with an open file, but
any iterable could do (say a list of strings). Your decision should be
informed by what is useful <em>and</em> what is easy to test. Having a
function to convert a string to a rectangle could be handy, but for now
we will take the entire for loop.</p>
<div class="codewrapper sourceCode" id="cb4">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb4-1"><a href="#cb4-1" tabindex="-1"></a><span class="co"># test_overlap.py</span></span>
<span id="cb4-2"><a href="#cb4-2" tabindex="-1"></a><span class="kw">def</span> test_read_rectangles_simple(simple_input):</span>
<span id="cb4-3"><a href="#cb4-3" tabindex="-1"></a>    rectangles <span class="op">=</span> overlap.read_rectangles(simple_input)</span>
<span id="cb4-4"><a href="#cb4-4" tabindex="-1"></a>    <span class="cf">assert</span> rectangles <span class="op">==</span> {</span>
<span id="cb4-5"><a href="#cb4-5" tabindex="-1"></a>        <span class="st">'a'</span>: [<span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">2</span>, <span class="dv">2</span>],</span>
<span id="cb4-6"><a href="#cb4-6" tabindex="-1"></a>        <span class="st">'b'</span>: [<span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">3</span>, <span class="dv">3</span>],</span>
<span id="cb4-7"><a href="#cb4-7" tabindex="-1"></a>        <span class="st">'c'</span>: [<span class="dv">10</span>, <span class="dv">10</span>, <span class="dv">11</span>, <span class="dv">11</span>],</span>
<span id="cb4-8"><a href="#cb4-8" tabindex="-1"></a>    }</span></code></pre>
</div>
<p>Which fails because we don’t have a method named
<code>read_rectangles</code>. Note that we have already decided on a
name for the function, its arguments and return values without touching
our source code.</p>
</div>
<div class="section level3">
<h3 id="green">Green<a class="anchor" aria-label="anchor" href="#green"></a></h3>
<p>Now we can pull out the function and replace that for loop with a
function call.</p>
<div id="fix-the-code" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<div id="fix-the-code" class="callout-inner">
<h3 class="callout-title">Fix the code</h3>
<div class="callout-content">
<p>Change the overlap file to make the above test pass.</p>
</div>
</div>
</div>
<div id="accordionSolution1" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution1" aria-expanded="false" aria-controls="collapseSolution1">
  <h4 class="accordion-header" id="headingSolution1"> Show me the solution </h4>
</button>
<div id="collapseSolution1" class="accordion-collapse collapse" data-bs-parent="#accordionSolution1" aria-labelledby="headingSolution1">
<div class="accordion-body">
<div class="codewrapper sourceCode" id="cb5">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb5-1"><a href="#cb5-1" tabindex="-1"></a><span class="kw">def</span> main(infile, outfile):</span>
<span id="cb5-2"><a href="#cb5-2" tabindex="-1"></a><span class="bu">dict</span> <span class="op">=</span> read_rectangles(infile)</span>
<span id="cb5-3"><a href="#cb5-3" tabindex="-1"></a>...</span>
<span id="cb5-4"><a href="#cb5-4" tabindex="-1"></a></span>
<span id="cb5-5"><a href="#cb5-5" tabindex="-1"></a></span>
<span id="cb5-6"><a href="#cb5-6" tabindex="-1"></a><span class="kw">def</span> read_rectangles(infile):</span>
<span id="cb5-7"><a href="#cb5-7" tabindex="-1"></a>result <span class="op">=</span> {}</span>
<span id="cb5-8"><a href="#cb5-8" tabindex="-1"></a><span class="cf">for</span> line <span class="kw">in</span> infile:</span>
<span id="cb5-9"><a href="#cb5-9" tabindex="-1"></a>    name, <span class="op">*</span>coords <span class="op">=</span> line.split()</span>
<span id="cb5-10"><a href="#cb5-10" tabindex="-1"></a>    result[name] <span class="op">=</span> [<span class="bu">int</span>(c) <span class="cf">for</span> c <span class="kw">in</span> coords]</span>
<span id="cb5-11"><a href="#cb5-11" tabindex="-1"></a><span class="cf">return</span> result</span></code></pre>
</div>
<p>When you start refactoring like this go slow and in parts. Make the
function first and when the <code>test_read_rectangles</code> passes
replace the code in the main method. Your end to end test should still
pass and tell you if something is wrong. Note we can remove the comment
because the function name is self documenting.</p>
</div>
</div>
</div>
</div>
</div>
<div class="section level3">
<h3 id="refactor">Refactor<a class="anchor" aria-label="anchor" href="#refactor"></a></h3>
<p>With read rectangles pulled out, let’s rename our <code>dict</code>
to rectangles. Since the argument to our function can be any iterable of
strings, we can also rename it to <code>rectangles</code> and add a type
annotation to show what we expect as input. Now is also the time to add
a doc string. Make changes step-wise and run your tests frequently.</p>
<div class="codewrapper sourceCode" id="cb6">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb6-1"><a href="#cb6-1" tabindex="-1"></a><span class="im">from</span> collections.abc <span class="im">import</span> Iterable</span>
<span id="cb6-2"><a href="#cb6-2" tabindex="-1"></a></span>
<span id="cb6-3"><a href="#cb6-3" tabindex="-1"></a><span class="kw">def</span> main(infile, outfile):</span>
<span id="cb6-4"><a href="#cb6-4" tabindex="-1"></a>    rectangles <span class="op">=</span> read_rectangles(infile)</span>
<span id="cb6-5"><a href="#cb6-5" tabindex="-1"></a>    ...</span>
<span id="cb6-6"><a href="#cb6-6" tabindex="-1"></a></span>
<span id="cb6-7"><a href="#cb6-7" tabindex="-1"></a></span>
<span id="cb6-8"><a href="#cb6-8" tabindex="-1"></a><span class="kw">def</span> read_rectangles(rectangles: Iterable[<span class="bu">str</span>]) <span class="op">-&gt;</span> <span class="bu">dict</span>[<span class="bu">str</span>, <span class="bu">list</span>[<span class="bu">float</span>]]:</span>
<span id="cb6-9"><a href="#cb6-9" tabindex="-1"></a>    result <span class="op">=</span> {}</span>
<span id="cb6-10"><a href="#cb6-10" tabindex="-1"></a>    <span class="cf">for</span> rectangle <span class="kw">in</span> rectangles:</span>
<span id="cb6-11"><a href="#cb6-11" tabindex="-1"></a>        name, <span class="op">*</span>coords <span class="op">=</span> rectangle.split()</span>
<span id="cb6-12"><a href="#cb6-12" tabindex="-1"></a>        result[name] <span class="op">=</span> [<span class="bu">int</span>(c) <span class="cf">for</span> c <span class="kw">in</span> coords]</span>
<span id="cb6-13"><a href="#cb6-13" tabindex="-1"></a>    <span class="cf">return</span> result</span></code></pre>
</div>
<p>Note our return value is a list of floats, ints are implied by that
and we may want to support floats later (hint, we do!).</p>
</div>
</div>
<div class="section level2">
<h2 id="test-like-an-enemy">Test like an enemy<a class="anchor" aria-label="anchor" href="#test-like-an-enemy"></a></h2>
<p>With a small, testable method in place, we can start adding features
and get creative. Often you will take the mindset of an adversary of a
codebase. This is generally easier with someone else’s code because you
can think “I bet they didn’t think of this” instead of “why didn’t I
think of this”, but being self deprecating gets easier with
practice.</p>
<p>Think of all the ways the overlap code could break, all the things
that aren’t tested, and how you would expect them to be handled.
Remember users aren’t perfect so expect non-optimal inputs. It’s better
to fail early (and descriptively) than several lines or modules
away.</p>
<div id="red-green-refactor-the-read_rectangles" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<div id="red-green-refactor-the-read_rectangles" class="callout-inner">
<h3 class="callout-title">Red-Green-Refactor the
<code>read_rectangles</code>
</h3>
<div class="callout-content">
<p>Pick one of the following and work through a red-green-refactor cycle
to address it. Work on more as time permits. Remember to keep each phase
short and run pytest often. Stop adding code once a test starts passing.
- How to handle empty input? - Non-numeric X and Y coordinates? - X and
Y coordinates that are floats? - X and Y coordinates not equal? (how are
we not testing this!) - X and Y coordinates are not in increasing order?
- Incorrect number of coordinates supplied? - Any others you can think
of?</p>
<p>Often there isn’t one right answer. When the user gives an empty
file, should that be an empty result or throw an error? The answer may
not matter, but formalizing it as a test forces you to answer and
document such questions. Look up <code>pytest.raises</code> for how to
test if an exception is thrown.</p>
</div>
</div>
</div>
<div id="accordionSolution2" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution2" aria-expanded="false" aria-controls="collapseSolution2">
  <h4 class="accordion-header" id="headingSolution2"> Show me the solution </h4>
</button>
<div id="collapseSolution2" class="accordion-collapse collapse" data-bs-parent="#accordionSolution2" aria-labelledby="headingSolution2">
<div class="accordion-body">
<p>Here is one set of tests and passing code. You may have chosen
different behavior for some changes.</p>
<div class="codewrapper sourceCode" id="cb7">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb7-1"><a href="#cb7-1" tabindex="-1"></a> <span class="co"># test_overlap.py</span></span>
<span id="cb7-2"><a href="#cb7-2" tabindex="-1"></a><span class="kw">def</span> test_read_rectangles_empty_input_empty_output():</span>
<span id="cb7-3"><a href="#cb7-3" tabindex="-1"></a>    rectangles <span class="op">=</span> overlap.read_rectangles([])</span>
<span id="cb7-4"><a href="#cb7-4" tabindex="-1"></a>    <span class="cf">assert</span> rectangles <span class="op">==</span> {}</span>
<span id="cb7-5"><a href="#cb7-5" tabindex="-1"></a></span>
<span id="cb7-6"><a href="#cb7-6" tabindex="-1"></a><span class="kw">def</span> test_read_rectangles_non_numeric_coord_raise_error():</span>
<span id="cb7-7"><a href="#cb7-7" tabindex="-1"></a>    <span class="cf">with</span> pytest.raises(<span class="pp">ValueError</span>) <span class="im">as</span> error:</span>
<span id="cb7-8"><a href="#cb7-8" tabindex="-1"></a>        overlap.read_rectangles([<span class="st">'a a a a a'</span>])</span>
<span id="cb7-9"><a href="#cb7-9" tabindex="-1"></a>    <span class="cf">assert</span> <span class="st">"Non numeric value provided as input for 'a a a a a'"</span> <span class="kw">in</span> <span class="bu">str</span>(error)</span>
<span id="cb7-10"><a href="#cb7-10" tabindex="-1"></a></span>
<span id="cb7-11"><a href="#cb7-11" tabindex="-1"></a><span class="kw">def</span> test_read_rectangles_accepts_floats():</span>
<span id="cb7-12"><a href="#cb7-12" tabindex="-1"></a>    lines <span class="op">=</span> [<span class="st">'a 0.3 0.3 1.0 1.0'</span>]</span>
<span id="cb7-13"><a href="#cb7-13" tabindex="-1"></a>    rectangles <span class="op">=</span> overlap.read_rectangles(lines)</span>
<span id="cb7-14"><a href="#cb7-14" tabindex="-1"></a>    coords <span class="op">=</span> rectangles[<span class="st">'a'</span>]</span>
<span id="cb7-15"><a href="#cb7-15" tabindex="-1"></a>    <span class="co"># Note that 0.3 != 0.1 + 0.2 due to floating point error, use pytest.approx</span></span>
<span id="cb7-16"><a href="#cb7-16" tabindex="-1"></a>    <span class="cf">assert</span> coords[<span class="dv">0</span>] <span class="op">==</span> pytest.approx(<span class="fl">0.1</span> <span class="op">+</span> <span class="fl">0.2</span>)</span>
<span id="cb7-17"><a href="#cb7-17" tabindex="-1"></a>    <span class="cf">assert</span> coords[<span class="dv">1</span>] <span class="op">==</span> <span class="fl">0.3</span></span>
<span id="cb7-18"><a href="#cb7-18" tabindex="-1"></a>    <span class="cf">assert</span> coords[<span class="dv">2</span>] <span class="op">==</span> <span class="fl">1.0</span></span>
<span id="cb7-19"><a href="#cb7-19" tabindex="-1"></a>    <span class="cf">assert</span> coords[<span class="dv">3</span>] <span class="op">==</span> <span class="fl">1.0</span></span>
<span id="cb7-20"><a href="#cb7-20" tabindex="-1"></a></span>
<span id="cb7-21"><a href="#cb7-21" tabindex="-1"></a><span class="kw">def</span> test_read_rectangles_not_equal_coords():</span>
<span id="cb7-22"><a href="#cb7-22" tabindex="-1"></a>    lines <span class="op">=</span> [<span class="st">'a 1 2 3 4'</span>]</span>
<span id="cb7-23"><a href="#cb7-23" tabindex="-1"></a>    rectangles <span class="op">=</span> overlap.read_rectangles(lines)</span>
<span id="cb7-24"><a href="#cb7-24" tabindex="-1"></a>    <span class="cf">assert</span> rectangles <span class="op">==</span> {<span class="st">'a'</span>: [<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">4</span>]}</span>
<span id="cb7-25"><a href="#cb7-25" tabindex="-1"></a></span>
<span id="cb7-26"><a href="#cb7-26" tabindex="-1"></a><span class="kw">def</span> test_read_rectangles_fix_order_of_coords():</span>
<span id="cb7-27"><a href="#cb7-27" tabindex="-1"></a>    lines <span class="op">=</span> [<span class="st">'a 3 4 1 2'</span>]</span>
<span id="cb7-28"><a href="#cb7-28" tabindex="-1"></a>    rectangles <span class="op">=</span> overlap.read_rectangles(lines)</span>
<span id="cb7-29"><a href="#cb7-29" tabindex="-1"></a>    <span class="cf">assert</span> rectangles <span class="op">==</span> {<span class="st">'a'</span>: [<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">4</span>]}</span>
<span id="cb7-30"><a href="#cb7-30" tabindex="-1"></a></span>
<span id="cb7-31"><a href="#cb7-31" tabindex="-1"></a><span class="kw">def</span> test_read_rectangles_incorrect_number_of_coords_raise_error():</span>
<span id="cb7-32"><a href="#cb7-32" tabindex="-1"></a>    <span class="cf">with</span> pytest.raises(<span class="pp">ValueError</span>) <span class="im">as</span> error:</span>
<span id="cb7-33"><a href="#cb7-33" tabindex="-1"></a>        overlap.read_rectangles([<span class="st">'a 1'</span>])</span>
<span id="cb7-34"><a href="#cb7-34" tabindex="-1"></a>    <span class="cf">assert</span> <span class="st">"Incorrect number of coordinates for 'a 1'"</span> <span class="kw">in</span> <span class="bu">str</span>(error)</span>
<span id="cb7-35"><a href="#cb7-35" tabindex="-1"></a></span>
<span id="cb7-36"><a href="#cb7-36" tabindex="-1"></a>    <span class="cf">with</span> pytest.raises(<span class="pp">ValueError</span>) <span class="im">as</span> error:</span>
<span id="cb7-37"><a href="#cb7-37" tabindex="-1"></a>        overlap.read_rectangles([<span class="st">'a'</span>])</span>
<span id="cb7-38"><a href="#cb7-38" tabindex="-1"></a>    <span class="cf">assert</span> <span class="st">"Incorrect number of coordinates for 'a'"</span> <span class="kw">in</span> <span class="bu">str</span>(error)</span></code></pre>
</div>
<div class="codewrapper sourceCode" id="cb8">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb8-1"><a href="#cb8-1" tabindex="-1"></a><span class="co"># overlap.py</span></span>
<span id="cb8-2"><a href="#cb8-2" tabindex="-1"></a><span class="kw">def</span> read_rectangles(rectangles: Iterable[<span class="bu">str</span>]) <span class="op">-&gt;</span> <span class="bu">dict</span>[<span class="bu">str</span>, <span class="bu">list</span>[<span class="bu">float</span>]]:</span>
<span id="cb8-3"><a href="#cb8-3" tabindex="-1"></a>    result <span class="op">=</span> {}</span>
<span id="cb8-4"><a href="#cb8-4" tabindex="-1"></a>    <span class="cf">for</span> rectangle <span class="kw">in</span> rectangles:</span>
<span id="cb8-5"><a href="#cb8-5" tabindex="-1"></a>        name, <span class="op">*</span>coords <span class="op">=</span> rectangle.split()</span>
<span id="cb8-6"><a href="#cb8-6" tabindex="-1"></a>        <span class="cf">try</span>:</span>
<span id="cb8-7"><a href="#cb8-7" tabindex="-1"></a>            value <span class="op">=</span> [<span class="bu">float</span>(c) <span class="cf">for</span> c <span class="kw">in</span> coords]</span>
<span id="cb8-8"><a href="#cb8-8" tabindex="-1"></a>        <span class="cf">except</span> <span class="pp">ValueError</span>:</span>
<span id="cb8-9"><a href="#cb8-9" tabindex="-1"></a>            <span class="cf">raise</span> <span class="pp">ValueError</span>(<span class="ss">f"Non numeric value provided as input for '</span><span class="sc">{</span>rectangle<span class="sc">}</span><span class="ss">'"</span>)</span>
<span id="cb8-10"><a href="#cb8-10" tabindex="-1"></a></span>
<span id="cb8-11"><a href="#cb8-11" tabindex="-1"></a>        <span class="cf">if</span> <span class="bu">len</span>(value) <span class="op">!=</span> <span class="dv">4</span>:</span>
<span id="cb8-12"><a href="#cb8-12" tabindex="-1"></a>            <span class="cf">raise</span> <span class="pp">ValueError</span>(<span class="ss">f"Incorrect number of coordinates for '</span><span class="sc">{</span>rectangle<span class="sc">}</span><span class="ss">'"</span>)</span>
<span id="cb8-13"><a href="#cb8-13" tabindex="-1"></a></span>
<span id="cb8-14"><a href="#cb8-14" tabindex="-1"></a>        <span class="co"># make sure x1 &lt;= x2, value = [x1, y1, x2, y2]</span></span>
<span id="cb8-15"><a href="#cb8-15" tabindex="-1"></a>        value[<span class="dv">0</span>], value[<span class="dv">2</span>] <span class="op">=</span> <span class="bu">min</span>(value[<span class="dv">0</span>], value[<span class="dv">2</span>]), <span class="bu">max</span>(value[<span class="dv">0</span>], value[<span class="dv">2</span>])</span>
<span id="cb8-16"><a href="#cb8-16" tabindex="-1"></a>        value[<span class="dv">1</span>], value[<span class="dv">3</span>] <span class="op">=</span> <span class="bu">min</span>(value[<span class="dv">1</span>], value[<span class="dv">3</span>]), <span class="bu">max</span>(value[<span class="dv">1</span>], value[<span class="dv">3</span>])</span>
<span id="cb8-17"><a href="#cb8-17" tabindex="-1"></a>        result[name] <span class="op">=</span> value</span>
<span id="cb8-18"><a href="#cb8-18" tabindex="-1"></a>    <span class="cf">return</span> result</span></code></pre>
</div>
<p>Notice how the test code is much longer than the source code, this is
typical for well-tested code.</p>
</div>
</div>
</div>
</div>
<p>A good question is, do we need to update our end-to-end test to cover
all these pathological cases? The answer is no (for most). We already
know our <code>read_rectangles</code> will handle the incorrect number
of coordinates by throwing an informative error so it would be redundant
to see if the main method has the same behavior. However, it would be
useful to document what happens if an empty input file is supplied.
Maybe you want <code>read_rectangles</code> to return an empty dict but
the main method should warn the user or fail.</p>
<p>The decision not to test something in multiple places is more
important than being efficient with our time writing tests. Say we want
to change the message printed for one of the improper input cases. If
the same function is tested multiple places we need to update multiple
tests that are effectively covering the same feature. Remember that
tests are code and should be kept DRY. Tests that are hard to change
don’t get run and code eventually degrades back to a legacy version.</p>
</div>
<div class="section level2">
<h2 id="testing-testing-for-overlap">Testing testing for overlap<a class="anchor" aria-label="anchor" href="#testing-testing-for-overlap"></a></h2>
<p>We have arrived to the largest needed refactoring, the overlap code.
This is the internals of the nested for loop.</p>
<div class="codewrapper sourceCode" id="cb9">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb9-1"><a href="#cb9-1" tabindex="-1"></a>...</span>
<span id="cb9-2"><a href="#cb9-2" tabindex="-1"></a><span class="cf">for</span> blue_name, blue_coords <span class="kw">in</span> rectangles.items():</span>
<span id="cb9-3"><a href="#cb9-3" tabindex="-1"></a>    <span class="co"># check if rects overlap</span></span>
<span id="cb9-4"><a href="#cb9-4" tabindex="-1"></a>    result <span class="op">=</span> <span class="st">'1'</span></span>
<span id="cb9-5"><a href="#cb9-5" tabindex="-1"></a></span>
<span id="cb9-6"><a href="#cb9-6" tabindex="-1"></a>    red_lo_x, red_lo_y, red_hi_x, red_hi_y <span class="op">=</span> red_coords</span>
<span id="cb9-7"><a href="#cb9-7" tabindex="-1"></a>    blue_lo_x, blue_lo_y, blue_hi_x, blue_hi_y <span class="op">=</span> blue_coords</span>
<span id="cb9-8"><a href="#cb9-8" tabindex="-1"></a></span>
<span id="cb9-9"><a href="#cb9-9" tabindex="-1"></a>    <span class="cf">if</span> (red_lo_x <span class="op">&gt;=</span> blue_hi_x) <span class="kw">or</span> (red_hi_x <span class="op">&lt;=</span> blue_lo_x) <span class="kw">or</span> <span class="op">\</span></span>
<span id="cb9-10"><a href="#cb9-10" tabindex="-1"></a>            (red_lo_y <span class="op">&gt;=</span> blue_hi_x) <span class="kw">or</span> (red_hi_y <span class="op">&lt;=</span> blue_lo_y):</span>
<span id="cb9-11"><a href="#cb9-11" tabindex="-1"></a>        result <span class="op">=</span> <span class="st">'0'</span></span>
<span id="cb9-12"><a href="#cb9-12" tabindex="-1"></a>...</span></code></pre>
</div>
<p>Like before, we want to write a failing test first and extract this
method. When that is in place we can start getting creative to test more
interesting cases. Finally, to support our original goal (reporting the
percent overlap) we will change our return type to another
rectangle.</p>
<div id="red-green-refactor-rects_overlap" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<div id="red-green-refactor-rects_overlap" class="callout-inner">
<h3 class="callout-title">Red-Green-Refactor
<code>rects_overlap</code>
</h3>
<div class="callout-content">
<p>Extract the inner for loop code. The signature should be:</p>
<div class="codewrapper sourceCode" id="cb10">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb10-1"><a href="#cb10-1" tabindex="-1"></a><span class="kw">def</span> rects_overlap(red, blue) <span class="op">-&gt;</span> <span class="bu">bool</span>: ...</span></code></pre>
</div>
</div>
</div>
</div>
<div id="accordionSolution3" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution3" aria-expanded="false" aria-controls="collapseSolution3">
  <h4 class="accordion-header" id="headingSolution3"> Show me the solution </h4>
</button>
<div id="collapseSolution3" class="accordion-collapse collapse" data-bs-parent="#accordionSolution3" aria-labelledby="headingSolution3">
<div class="accordion-body">
<p>For testing, I’m using the simple input, when parsed from
<code>read_rectangles</code>. Notice that if we had used
<code>read_rectangles</code> to do the parsing we would add a dependency
between that function and this one. If we change (break)
<code>read_rectangles</code> this would break too even though nothing is
wrong with <code>rects_overlap</code>. However, uncoupling them
completely doesn’t capture how they interact in code. Consider the
drawbacks before deciding what to use.</p>
<div class="codewrapper sourceCode" id="cb11">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb11-1"><a href="#cb11-1" tabindex="-1"></a> <span class="co"># test_overlap.py</span></span>
<span id="cb11-2"><a href="#cb11-2" tabindex="-1"></a><span class="kw">def</span> test_rects_overlap():</span>
<span id="cb11-3"><a href="#cb11-3" tabindex="-1"></a>    rectangles <span class="op">=</span> {</span>
<span id="cb11-4"><a href="#cb11-4" tabindex="-1"></a>        <span class="st">'a'</span>: [<span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">2</span>, <span class="dv">2</span>],</span>
<span id="cb11-5"><a href="#cb11-5" tabindex="-1"></a>        <span class="st">'b'</span>: [<span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">3</span>, <span class="dv">3</span>],</span>
<span id="cb11-6"><a href="#cb11-6" tabindex="-1"></a>        <span class="st">'c'</span>: [<span class="dv">10</span>, <span class="dv">10</span>, <span class="dv">11</span>, <span class="dv">11</span>],</span>
<span id="cb11-7"><a href="#cb11-7" tabindex="-1"></a>    }</span>
<span id="cb11-8"><a href="#cb11-8" tabindex="-1"></a></span>
<span id="cb11-9"><a href="#cb11-9" tabindex="-1"></a>    <span class="cf">assert</span> overlap.rects_overlap(rectangles[<span class="st">'a'</span>], rectangles[<span class="st">'a'</span>]) <span class="kw">is</span> <span class="va">True</span></span>
<span id="cb11-10"><a href="#cb11-10" tabindex="-1"></a>    <span class="cf">assert</span> overlap.rects_overlap(rectangles[<span class="st">'a'</span>], rectangles[<span class="st">'b'</span>]) <span class="kw">is</span> <span class="va">True</span></span>
<span id="cb11-11"><a href="#cb11-11" tabindex="-1"></a>    <span class="cf">assert</span> overlap.rects_overlap(rectangles[<span class="st">'b'</span>], rectangles[<span class="st">'a'</span>]) <span class="kw">is</span> <span class="va">True</span></span>
<span id="cb11-12"><a href="#cb11-12" tabindex="-1"></a>    <span class="cf">assert</span> overlap.rects_overlap(rectangles[<span class="st">'a'</span>], rectangles[<span class="st">'c'</span>]) <span class="kw">is</span> <span class="va">False</span></span></code></pre>
</div>
<div class="codewrapper sourceCode" id="cb12">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb12-1"><a href="#cb12-1" tabindex="-1"></a><span class="co"># overlap.py</span></span>
<span id="cb12-2"><a href="#cb12-2" tabindex="-1"></a><span class="kw">def</span> main(infile, outfile):</span>
<span id="cb12-3"><a href="#cb12-3" tabindex="-1"></a>    rectangles <span class="op">=</span> read_rectangles(infile)</span>
<span id="cb12-4"><a href="#cb12-4" tabindex="-1"></a></span>
<span id="cb12-5"><a href="#cb12-5" tabindex="-1"></a>    <span class="cf">for</span> red_name, red_coords <span class="kw">in</span> rectangles.items():</span>
<span id="cb12-6"><a href="#cb12-6" tabindex="-1"></a>        output_line <span class="op">=</span> []</span>
<span id="cb12-7"><a href="#cb12-7" tabindex="-1"></a>        <span class="cf">for</span> blue_name, blue_coords <span class="kw">in</span> rectangles.items():</span>
<span id="cb12-8"><a href="#cb12-8" tabindex="-1"></a>            result <span class="op">=</span> <span class="st">'1'</span> <span class="cf">if</span> rects_overlap(red_coords, blue_coords) <span class="cf">else</span> <span class="st">'0'</span></span>
<span id="cb12-9"><a href="#cb12-9" tabindex="-1"></a></span>
<span id="cb12-10"><a href="#cb12-10" tabindex="-1"></a>            output_line.append(result)</span>
<span id="cb12-11"><a href="#cb12-11" tabindex="-1"></a>        outfile.write(<span class="st">'</span><span class="ch">\t</span><span class="st">'</span>.join(output_line) <span class="op">+</span> <span class="st">'</span><span class="ch">\n</span><span class="st">'</span>)</span>
<span id="cb12-12"><a href="#cb12-12" tabindex="-1"></a></span>
<span id="cb12-13"><a href="#cb12-13" tabindex="-1"></a>...</span>
<span id="cb12-14"><a href="#cb12-14" tabindex="-1"></a><span class="kw">def</span> rects_overlap(red, blue) <span class="op">-&gt;</span> <span class="bu">bool</span>:</span>
<span id="cb12-15"><a href="#cb12-15" tabindex="-1"></a>    red_lo_x, red_lo_y, red_hi_x, red_hi_y <span class="op">=</span> red</span>
<span id="cb12-16"><a href="#cb12-16" tabindex="-1"></a>    blue_lo_x, blue_lo_y, blue_hi_x, blue_hi_y <span class="op">=</span> blue</span>
<span id="cb12-17"><a href="#cb12-17" tabindex="-1"></a></span>
<span id="cb12-18"><a href="#cb12-18" tabindex="-1"></a>    <span class="cf">if</span> (red_lo_x <span class="op">&gt;=</span> blue_hi_x) <span class="kw">or</span> (red_hi_x <span class="op">&lt;=</span> blue_lo_x) <span class="kw">or</span> <span class="op">\</span></span>
<span id="cb12-19"><a href="#cb12-19" tabindex="-1"></a>            (red_lo_y <span class="op">&gt;=</span> blue_hi_x) <span class="kw">or</span> (red_hi_y <span class="op">&lt;=</span> blue_lo_y):</span>
<span id="cb12-20"><a href="#cb12-20" tabindex="-1"></a>        <span class="cf">return</span> <span class="va">False</span></span>
<span id="cb12-21"><a href="#cb12-21" tabindex="-1"></a></span>
<span id="cb12-22"><a href="#cb12-22" tabindex="-1"></a>    <span class="cf">return</span> <span class="va">True</span></span></code></pre>
</div>
</div>
</div>
</div>
</div>
<p>Now we can really put the function through it’s paces. Here are some
rectangles to guide your testing:</p>
<pre><code>
     ┌───┐     ┌──┬──┐   ┌──────┐    ┌─┐
     │  ┌┼─┐   │  │  │   │ ┌──┐ │    └─┼─┐
     └──┼┘ │   └──┴──┘   └─┼──┼─┘      └─┘
        └──┘               └──┘             </code></pre>
<p>For each, consider swapping the red and blue labels and rotating 90
degrees. Rotating a coordinate 90 degrees clockwise is simply swapping x
and y while negating the new y value. If you thought the rotation
function would be useful elsewhere, you could add it to your script, but
for now we will keep it in our pytest code. First, write some failing
unit tests of our new helper function:</p>
<div class="codewrapper sourceCode" id="cb14">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb14-1"><a href="#cb14-1" tabindex="-1"></a><span class="co"># test_overlap.py</span></span>
<span id="cb14-2"><a href="#cb14-2" tabindex="-1"></a><span class="kw">def</span> test_rotate_rectangle():</span>
<span id="cb14-3"><a href="#cb14-3" tabindex="-1"></a>    rectangle <span class="op">=</span> [<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">3</span>]</span>
<span id="cb14-4"><a href="#cb14-4" tabindex="-1"></a></span>
<span id="cb14-5"><a href="#cb14-5" tabindex="-1"></a>    rectangle <span class="op">=</span> rotate_rectangle(rectangle)</span>
<span id="cb14-6"><a href="#cb14-6" tabindex="-1"></a>    <span class="cf">assert</span> rectangle <span class="op">==</span> [<span class="dv">2</span>, <span class="op">-</span><span class="dv">3</span>, <span class="dv">3</span>, <span class="op">-</span><span class="dv">1</span>]</span>
<span id="cb14-7"><a href="#cb14-7" tabindex="-1"></a></span>
<span id="cb14-8"><a href="#cb14-8" tabindex="-1"></a>    rectangle <span class="op">=</span> rotate_rectangle(rectangle)</span>
<span id="cb14-9"><a href="#cb14-9" tabindex="-1"></a>    <span class="cf">assert</span> rectangle <span class="op">==</span> [<span class="op">-</span><span class="dv">3</span>, <span class="op">-</span><span class="dv">3</span>, <span class="op">-</span><span class="dv">1</span>, <span class="op">-</span><span class="dv">2</span>]</span>
<span id="cb14-10"><a href="#cb14-10" tabindex="-1"></a></span>
<span id="cb14-11"><a href="#cb14-11" tabindex="-1"></a>    rectangle <span class="op">=</span> rotate_rectangle(rectangle)</span>
<span id="cb14-12"><a href="#cb14-12" tabindex="-1"></a>    <span class="cf">assert</span> rectangle <span class="op">==</span> [<span class="op">-</span><span class="dv">3</span>, <span class="dv">1</span>, <span class="op">-</span><span class="dv">2</span>, <span class="dv">3</span>]</span>
<span id="cb14-13"><a href="#cb14-13" tabindex="-1"></a></span>
<span id="cb14-14"><a href="#cb14-14" tabindex="-1"></a>    rectangle <span class="op">=</span> rotate_rectangle(rectangle)</span>
<span id="cb14-15"><a href="#cb14-15" tabindex="-1"></a>    <span class="cf">assert</span> rectangle <span class="op">==</span> [<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">3</span>]</span></code></pre>
</div>
<p>Writing out the different permutations was challenging (for me, at
least), probably related to having unnamed attributes for our rectangle
as a list of numbers… Then you need to produce the correct rectangle
where <code>x1 &lt;= x2</code>.</p>
<div class="codewrapper sourceCode" id="cb15">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb15-1"><a href="#cb15-1" tabindex="-1"></a><span class="co"># test_overlap.py</span></span>
<span id="cb15-2"><a href="#cb15-2" tabindex="-1"></a><span class="kw">def</span> rotate_rectangle(rectangle):</span>
<span id="cb15-3"><a href="#cb15-3" tabindex="-1"></a>    x1, y1, x2, y2 <span class="op">=</span> rectangle</span>
<span id="cb15-4"><a href="#cb15-4" tabindex="-1"></a>    x1, y1 <span class="op">=</span> y1, <span class="op">-</span>x1</span>
<span id="cb15-5"><a href="#cb15-5" tabindex="-1"></a>    x2, y2 <span class="op">=</span> y2, <span class="op">-</span>x2</span>
<span id="cb15-6"><a href="#cb15-6" tabindex="-1"></a></span>
<span id="cb15-7"><a href="#cb15-7" tabindex="-1"></a>    <span class="co"># make sure x1 &lt;= x2, value = [x1, y1, x2, y2]</span></span>
<span id="cb15-8"><a href="#cb15-8" tabindex="-1"></a>    x1, x2 <span class="op">=</span> <span class="bu">min</span>(x1, x2), <span class="bu">max</span>(x1, x2)</span>
<span id="cb15-9"><a href="#cb15-9" tabindex="-1"></a>    y1, y2 <span class="op">=</span> <span class="bu">min</span>(y1, y2), <span class="bu">max</span>(y1, y2)</span>
<span id="cb15-10"><a href="#cb15-10" tabindex="-1"></a></span>
<span id="cb15-11"><a href="#cb15-11" tabindex="-1"></a>    <span class="cf">return</span> [x1, y1, x2, y2]</span></code></pre>
</div>
<p>Notice this is <em>still</em> in our test file. We don’t want it in
our project and it’s just a helper for our tests, we could use it
elsewhere in later tests. Since the function is non-trivial we also have
it tested. For helper functions that mutate or wrap inputs, you
<em>could</em> have them non-tested but beware the simple helper
function may evolve into something more complex!</p>
<div id="test-the-first-overlap-orientation" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<div id="test-the-first-overlap-orientation" class="callout-inner">
<h3 class="callout-title">Test the first overlap orientation</h3>
<div class="callout-content">
<p>Start with the first type of overlap (over corners). Set one
rectangle to <code>(-1, -1, 1, 1)</code> and place the second rectangle.
Transform the second rectangle by rotating it around the origin 3 times
and test the <code>rects_overlap</code> function for each overlap and
red/blue assignment. Hint: pytest code is still python!</p>
</div>
</div>
</div>
<div id="accordionSolution4" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution4" aria-expanded="false" aria-controls="collapseSolution4">
  <h4 class="accordion-header" id="headingSolution4"> Show me the solution </h4>
</button>
<div id="collapseSolution4" class="accordion-collapse collapse" data-bs-parent="#accordionSolution4" aria-labelledby="headingSolution4">
<div class="accordion-body">
<p>With our <code>rotate_rectangle</code> function in hand, the test
function needs to test <code>rects_overlap</code> twice (swapping
arguments each time) then rotate the second rectangle. Note the choice
of centering the first rectangle on the origin makes it rotationally
invariant. Here is a test function, notice that the assert statements
have a clear message as it would otherwise be difficult to tell when a
test failed.</p>
<div class="codewrapper sourceCode" id="cb16">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb16-1"><a href="#cb16-1" tabindex="-1"></a><span class="kw">def</span> test_rects_overlap_permutations():</span>
<span id="cb16-2"><a href="#cb16-2" tabindex="-1"></a>    rectangle_1 <span class="op">=</span> [<span class="op">-</span><span class="dv">1</span>, <span class="op">-</span><span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>]</span>
<span id="cb16-3"><a href="#cb16-3" tabindex="-1"></a>    rectangle_2 <span class="op">=</span> [<span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">2</span>, <span class="dv">3</span>]</span>
<span id="cb16-4"><a href="#cb16-4" tabindex="-1"></a>    result <span class="op">=</span> <span class="va">True</span></span>
<span id="cb16-5"><a href="#cb16-5" tabindex="-1"></a></span>
<span id="cb16-6"><a href="#cb16-6" tabindex="-1"></a>    <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">4</span>):</span>
<span id="cb16-7"><a href="#cb16-7" tabindex="-1"></a>        <span class="cf">assert</span> overlap.rects_overlap(rectangle_1, rectangle_2) <span class="op">==</span> result, (</span>
<span id="cb16-8"><a href="#cb16-8" tabindex="-1"></a>            <span class="ss">f"Failed rects_overlap(</span><span class="sc">{</span>rectangle_1<span class="sc">}</span><span class="ss">, </span><span class="sc">{</span>rectangle_2<span class="sc">}</span><span class="ss">) "</span></span>
<span id="cb16-9"><a href="#cb16-9" tabindex="-1"></a>            <span class="ss">f"on rotation </span><span class="sc">{</span>i<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb16-10"><a href="#cb16-10" tabindex="-1"></a></span>
<span id="cb16-11"><a href="#cb16-11" tabindex="-1"></a>        <span class="cf">assert</span> overlap.rects_overlap(rectangle_2, rectangle_1) <span class="op">==</span> result, (</span>
<span id="cb16-12"><a href="#cb16-12" tabindex="-1"></a>            <span class="ss">f"Failed rects_overlap(</span><span class="sc">{</span>rectangle_2<span class="sc">}</span><span class="ss">, </span><span class="sc">{</span>rectangle_1<span class="sc">}</span><span class="ss">) "</span></span>
<span id="cb16-13"><a href="#cb16-13" tabindex="-1"></a>            <span class="ss">f"on rotation </span><span class="sc">{</span>i<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb16-14"><a href="#cb16-14" tabindex="-1"></a></span>
<span id="cb16-15"><a href="#cb16-15" tabindex="-1"></a>        rectangle_2 <span class="op">=</span> rotate_rectangle(rectangle_2)</span></code></pre>
</div>
<p>I declare the result to simplify parameterize introduced next.</p>
</div>
</div>
</div>
</div>
<p>We have <code>test_rects_overlap_permutations</code> written for one
rectangle. You may be tempted to copy and paste the function multiple
times and declare a different <code>rectangle_2</code> and result for
each orientation we came up with above. To avoid code duplication, you
could make our test a helper function, but pytest has a better builtin
option, <code>parameterize</code>.</p>
</div>
<div class="section level2">
<h2 id="pytest-mark-parametrize"><code>pytest.mark.parametrize</code><a class="anchor" aria-label="anchor" href="#pytest-mark-parametrize"></a></h2>
<p>Parametrizing a test function allows you to easily repeat its
execution with different input values. Using parameters cuts down on
duplication and can vastly increase the input space you can explore by
nesting parameters.</p>
<p>Let’s work on testing the following function:</p>
<div class="codewrapper sourceCode" id="cb17">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb17-1"><a href="#cb17-1" tabindex="-1"></a><span class="kw">def</span> square_sometimes(value, condition):</span>
<span id="cb17-2"><a href="#cb17-2" tabindex="-1"></a>    <span class="cf">if</span> condition:</span>
<span id="cb17-3"><a href="#cb17-3" tabindex="-1"></a>        <span class="cf">raise</span> <span class="pp">ValueError</span>()</span>
<span id="cb17-4"><a href="#cb17-4" tabindex="-1"></a>    <span class="cf">return</span> value <span class="op">**</span> <span class="dv">2</span></span></code></pre>
</div>
<p>Fully testing this function requires testing a variety of
<code>value</code>s and ensuring when <code>condition is True</code> the
function instead raises an error. Here are a few tests showing how you
could write multiple test functions:</p>
<div class="codewrapper sourceCode" id="cb18">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb18-1"><a href="#cb18-1" tabindex="-1"></a><span class="kw">def</span> test_square_sometimes_number_false():</span>
<span id="cb18-2"><a href="#cb18-2" tabindex="-1"></a>    <span class="cf">assert</span> square_sometimes(<span class="dv">4</span>, <span class="va">False</span>) <span class="op">==</span> <span class="dv">16</span></span>
<span id="cb18-3"><a href="#cb18-3" tabindex="-1"></a></span>
<span id="cb18-4"><a href="#cb18-4" tabindex="-1"></a><span class="kw">def</span> test_square_sometimes_number_true():</span>
<span id="cb18-5"><a href="#cb18-5" tabindex="-1"></a>    <span class="cf">with</span> pytest.raises(<span class="pp">ValueError</span>):</span>
<span id="cb18-6"><a href="#cb18-6" tabindex="-1"></a>        square_sometimes(<span class="dv">4</span>, <span class="va">True</span>)</span>
<span id="cb18-7"><a href="#cb18-7" tabindex="-1"></a></span>
<span id="cb18-8"><a href="#cb18-8" tabindex="-1"></a><span class="kw">def</span> test_square_sometimes_list_false():</span>
<span id="cb18-9"><a href="#cb18-9" tabindex="-1"></a>    <span class="cf">assert</span> square_sometimes([<span class="dv">1</span>, <span class="dv">1</span>], <span class="va">False</span>) <span class="op">==</span> [<span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>]</span>
<span id="cb18-10"><a href="#cb18-10" tabindex="-1"></a></span>
<span id="cb18-11"><a href="#cb18-11" tabindex="-1"></a><span class="kw">def</span> test_square_sometimes_list_true():</span>
<span id="cb18-12"><a href="#cb18-12" tabindex="-1"></a>    <span class="cf">with</span> pytest.raises(<span class="pp">ValueError</span>):</span>
<span id="cb18-13"><a href="#cb18-13" tabindex="-1"></a>        square_sometimes([<span class="dv">1</span>, <span class="dv">1</span>], <span class="va">True</span>)</span>
<span id="cb18-14"><a href="#cb18-14" tabindex="-1"></a>...</span></code></pre>
</div>
<p>Hopefully that code duplication is making your skin crawl! Maybe
instead you write a helper function to check the value of condition:</p>
<div class="codewrapper sourceCode" id="cb19">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb19-1"><a href="#cb19-1" tabindex="-1"></a><span class="kw">def</span> square_sometimes_test_helper(value, condition, output):</span>
<span id="cb19-2"><a href="#cb19-2" tabindex="-1"></a>    <span class="cf">if</span> condition:</span>
<span id="cb19-3"><a href="#cb19-3" tabindex="-1"></a>        <span class="cf">with</span> pytest.raises(<span class="pp">ValueError</span>):</span>
<span id="cb19-4"><a href="#cb19-4" tabindex="-1"></a>            square_sometimes(value, condition)</span>
<span id="cb19-5"><a href="#cb19-5" tabindex="-1"></a>    <span class="cf">else</span>:</span>
<span id="cb19-6"><a href="#cb19-6" tabindex="-1"></a>        <span class="cf">assert</span> square_sometimes(value, condition) <span class="op">==</span> output</span></code></pre>
</div>
<p>Then you can replace some of your tests with the helper calls:</p>
<div class="codewrapper sourceCode" id="cb20">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb20-1"><a href="#cb20-1" tabindex="-1"></a><span class="kw">def</span> test_square_sometimes_number():</span>
<span id="cb20-2"><a href="#cb20-2" tabindex="-1"></a>    square_sometimes_test_helper(<span class="dv">4</span>, <span class="va">False</span>, <span class="dv">16</span>)</span>
<span id="cb20-3"><a href="#cb20-3" tabindex="-1"></a>    square_sometimes_test_helper(<span class="dv">4</span>, <span class="va">True</span>, <span class="dv">16</span>)</span>
<span id="cb20-4"><a href="#cb20-4" tabindex="-1"></a></span>
<span id="cb20-5"><a href="#cb20-5" tabindex="-1"></a><span class="kw">def</span> test_square_sometimes_list():</span>
<span id="cb20-6"><a href="#cb20-6" tabindex="-1"></a>    square_sometimes_test_helper([<span class="dv">1</span>, <span class="dv">1</span>], <span class="va">False</span>, [<span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>])</span>
<span id="cb20-7"><a href="#cb20-7" tabindex="-1"></a>    square_sometimes_test_helper([<span class="dv">1</span>, <span class="dv">1</span>], <span class="va">True</span>, [<span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>])</span>
<span id="cb20-8"><a href="#cb20-8" tabindex="-1"></a>...</span></code></pre>
</div>
<p>You could imagine wrapping the helper calls in a loop and you’d
basically have a parametrized test. Using
<code>pytest.mark.parametrize</code> you’d instead have:</p>
<div class="codewrapper sourceCode" id="cb21">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb21-1"><a href="#cb21-1" tabindex="-1"></a><span class="at">@pytest.mark.parametrize</span>(</span>
<span id="cb21-2"><a href="#cb21-2" tabindex="-1"></a>    <span class="st">'value,output'</span>,</span>
<span id="cb21-3"><a href="#cb21-3" tabindex="-1"></a>    [</span>
<span id="cb21-4"><a href="#cb21-4" tabindex="-1"></a>        (<span class="dv">4</span>, <span class="dv">16</span>),</span>
<span id="cb21-5"><a href="#cb21-5" tabindex="-1"></a>        ([<span class="dv">1</span>,<span class="dv">1</span>], [<span class="dv">1</span>,<span class="dv">1</span>,<span class="dv">1</span>,<span class="dv">1</span>]),</span>
<span id="cb21-6"><a href="#cb21-6" tabindex="-1"></a>        (<span class="st">'asdf'</span>, <span class="st">'asdfasdf'</span>),</span>
<span id="cb21-7"><a href="#cb21-7" tabindex="-1"></a>    ]</span>
<span id="cb21-8"><a href="#cb21-8" tabindex="-1"></a>)</span>
<span id="cb21-9"><a href="#cb21-9" tabindex="-1"></a><span class="at">@pytest.mark.paramterize</span>(<span class="st">'condition'</span>, [<span class="va">True</span>, <span class="va">False</span>])</span>
<span id="cb21-10"><a href="#cb21-10" tabindex="-1"></a><span class="kw">def</span> test_square_sometimes(value, condition, output):</span>
<span id="cb21-11"><a href="#cb21-11" tabindex="-1"></a>    <span class="cf">if</span> condition:</span>
<span id="cb21-12"><a href="#cb21-12" tabindex="-1"></a>        <span class="cf">with</span> pytest.raises(<span class="pp">ValueError</span>):</span>
<span id="cb21-13"><a href="#cb21-13" tabindex="-1"></a>            square_sometimes(value, condition)</span>
<span id="cb21-14"><a href="#cb21-14" tabindex="-1"></a>    <span class="cf">else</span>:</span>
<span id="cb21-15"><a href="#cb21-15" tabindex="-1"></a>        <span class="cf">assert</span> square_sometimes(value, condition) <span class="op">==</span> output</span></code></pre>
</div>
<p>pytest will generate the cross product of all nested parameters, here
producing 6 tests. Notice how there is no code duplication and if you
come up with another test input, you just have to add it to the
‘value,output’ list; testing each condition will automatically happen.
Compared with coding the loops yourself, pytest generates better error
reporting on what set of parameters failed. Like most of pytest, there
is a lot more we aren’t covering like mixing parameters and
fixtures.</p>
<p>Here is the parameterized version of
<code>test_rects_overlap_permutations</code>. I added the unicode
rectangle images because I already made them above and it seemed like a
shame to not reuse. Normally I wouldn’t spend time making them and
instead use a text descriptor, e.g. “Corners overlap”.</p>
<div class="codewrapper sourceCode" id="cb22">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb22-1"><a href="#cb22-1" tabindex="-1"></a>rectangle_strs <span class="op">=</span> [<span class="st">'''</span></span>
<span id="cb22-2"><a href="#cb22-2" tabindex="-1"></a><span class="st">┌───┐  </span></span>
<span id="cb22-3"><a href="#cb22-3" tabindex="-1"></a><span class="st">│  ┌┼─┐</span></span>
<span id="cb22-4"><a href="#cb22-4" tabindex="-1"></a><span class="st">└──┼┘ │</span></span>
<span id="cb22-5"><a href="#cb22-5" tabindex="-1"></a><span class="st">   └──┘'''</span>,<span class="st">'''</span></span>
<span id="cb22-6"><a href="#cb22-6" tabindex="-1"></a><span class="st">┌──┬──┐</span></span>
<span id="cb22-7"><a href="#cb22-7" tabindex="-1"></a><span class="st">│  │  │</span></span>
<span id="cb22-8"><a href="#cb22-8" tabindex="-1"></a><span class="st">└──┴──┘'''</span>,<span class="st">'''</span></span>
<span id="cb22-9"><a href="#cb22-9" tabindex="-1"></a><span class="st">┌──────┐</span></span>
<span id="cb22-10"><a href="#cb22-10" tabindex="-1"></a><span class="st">│ ┌──┐ │</span></span>
<span id="cb22-11"><a href="#cb22-11" tabindex="-1"></a><span class="st">└─┼──┼─┘</span></span>
<span id="cb22-12"><a href="#cb22-12" tabindex="-1"></a><span class="st">  └──┘'''</span>,<span class="st">'''</span></span>
<span id="cb22-13"><a href="#cb22-13" tabindex="-1"></a><span class="st">┌─┐  </span></span>
<span id="cb22-14"><a href="#cb22-14" tabindex="-1"></a><span class="st">└─┼─┐</span></span>
<span id="cb22-15"><a href="#cb22-15" tabindex="-1"></a><span class="st">  └─┘'''</span>,<span class="st">'''</span></span>
<span id="cb22-16"><a href="#cb22-16" tabindex="-1"></a><span class="st">┌─┐  </span></span>
<span id="cb22-17"><a href="#cb22-17" tabindex="-1"></a><span class="st">└─┘ ┌─┐</span></span>
<span id="cb22-18"><a href="#cb22-18" tabindex="-1"></a><span class="st">    └─┘'''</span>,<span class="st">'''</span></span>
<span id="cb22-19"><a href="#cb22-19" tabindex="-1"></a><span class="st">┌──────┐</span></span>
<span id="cb22-20"><a href="#cb22-20" tabindex="-1"></a><span class="st">│  ┌─┐ │</span></span>
<span id="cb22-21"><a href="#cb22-21" tabindex="-1"></a><span class="st">│  └─┘ │</span></span>
<span id="cb22-22"><a href="#cb22-22" tabindex="-1"></a><span class="st">└──────┘'''</span>,</span>
<span id="cb22-23"><a href="#cb22-23" tabindex="-1"></a>                  ]</span>
<span id="cb22-24"><a href="#cb22-24" tabindex="-1"></a><span class="at">@pytest.mark.parametrize</span>(</span>
<span id="cb22-25"><a href="#cb22-25" tabindex="-1"></a>    <span class="st">"rectangle_2,rectangle_str,result"</span>,</span>
<span id="cb22-26"><a href="#cb22-26" tabindex="-1"></a>    [</span>
<span id="cb22-27"><a href="#cb22-27" tabindex="-1"></a>        ([<span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">2</span>, <span class="dv">3</span>], rectangle_strs[<span class="dv">0</span>], <span class="va">True</span>),</span>
<span id="cb22-28"><a href="#cb22-28" tabindex="-1"></a>        ([<span class="dv">1</span>, <span class="op">-</span><span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">1</span>], rectangle_strs[<span class="dv">1</span>], <span class="va">False</span>),</span>
<span id="cb22-29"><a href="#cb22-29" tabindex="-1"></a>        ([<span class="dv">0</span>, <span class="op">-</span><span class="dv">2</span>, <span class="fl">0.5</span>, <span class="dv">0</span>], rectangle_strs[<span class="dv">2</span>], <span class="va">True</span>),</span>
<span id="cb22-30"><a href="#cb22-30" tabindex="-1"></a>        ([<span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">2</span>], rectangle_strs[<span class="dv">3</span>], <span class="va">False</span>),</span>
<span id="cb22-31"><a href="#cb22-31" tabindex="-1"></a>        ([<span class="dv">2</span>, <span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">3</span>], rectangle_strs[<span class="dv">4</span>], <span class="va">False</span>),</span>
<span id="cb22-32"><a href="#cb22-32" tabindex="-1"></a>        ([<span class="dv">0</span>, <span class="dv">0</span>, <span class="fl">0.5</span>, <span class="fl">0.5</span>], rectangle_strs[<span class="dv">5</span>], <span class="va">True</span>),</span>
<span id="cb22-33"><a href="#cb22-33" tabindex="-1"></a>    ])</span>
<span id="cb22-34"><a href="#cb22-34" tabindex="-1"></a><span class="kw">def</span> test_rects_overlap_permutations(rectangle_2, rectangle_str, result):</span>
<span id="cb22-35"><a href="#cb22-35" tabindex="-1"></a>    rectangle_1 <span class="op">=</span> [<span class="op">-</span><span class="dv">1</span>, <span class="op">-</span><span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>]</span>
<span id="cb22-36"><a href="#cb22-36" tabindex="-1"></a></span>
<span id="cb22-37"><a href="#cb22-37" tabindex="-1"></a>    <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">4</span>):</span>
<span id="cb22-38"><a href="#cb22-38" tabindex="-1"></a>        <span class="cf">assert</span> overlap.rects_overlap(rectangle_1, rectangle_2) <span class="op">==</span> result, (</span>
<span id="cb22-39"><a href="#cb22-39" tabindex="-1"></a>            <span class="ss">f"Failed rects_overlap(</span><span class="sc">{</span>rectangle_1<span class="sc">}</span><span class="ss">, </span><span class="sc">{</span>rectangle_2<span class="sc">}</span><span class="ss">) "</span></span>
<span id="cb22-40"><a href="#cb22-40" tabindex="-1"></a>            <span class="ss">f"on rotation </span><span class="sc">{</span>i<span class="sc">}</span><span class="ss">. </span><span class="sc">{</span>rectangle_str<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb22-41"><a href="#cb22-41" tabindex="-1"></a></span>
<span id="cb22-42"><a href="#cb22-42" tabindex="-1"></a>        <span class="cf">assert</span> overlap.rects_overlap(rectangle_2, rectangle_1) <span class="op">==</span> result, (</span>
<span id="cb22-43"><a href="#cb22-43" tabindex="-1"></a>            <span class="ss">f"Failed rects_overlap(</span><span class="sc">{</span>rectangle_2<span class="sc">}</span><span class="ss">, </span><span class="sc">{</span>rectangle_1<span class="sc">}</span><span class="ss">) "</span></span>
<span id="cb22-44"><a href="#cb22-44" tabindex="-1"></a>            <span class="ss">f"on rotation </span><span class="sc">{</span>i<span class="sc">}</span><span class="ss">. </span><span class="sc">{</span>rectangle_str<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb22-45"><a href="#cb22-45" tabindex="-1"></a></span>
<span id="cb22-46"><a href="#cb22-46" tabindex="-1"></a>        rectangle_2 <span class="op">=</span> rotate_rectangle(rectangle_2)</span></code></pre>
</div>
<p>Now failed tests will also show the image along with information to
recreate any failures. Running the above should fail… Time to get back
to green.</p>
<p>Note that with parameterize, each set of parameters will be run,
e.g. failing on the second rectangle will not affect the running on the
third rectangle.</p>
<div id="fix-the-code-1" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<div id="fix-the-code-1" class="callout-inner">
<h3 class="callout-title">Fix the code</h3>
<div class="callout-content">
<p>Work on the source code for <code>rects_overlap</code> until all the
code passes. Hint: try <code>pytest --pdb test_overlap.py</code> which
launches pdb at the site of the first assertion error.</p>
</div>
</div>
</div>
<div id="accordionSolution5" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution5" aria-expanded="false" aria-controls="collapseSolution5">
  <h4 class="accordion-header" id="headingSolution5"> Show me the solution </h4>
</button>
<div id="collapseSolution5" class="accordion-collapse collapse" data-bs-parent="#accordionSolution5" aria-labelledby="headingSolution5">
<div class="accordion-body">
<p>Only one set of rectangles is failing and it’s on the first rotation.
That should indicate our tests are working properly and perhaps there is
a more subtle bug hiding in our code. Hopefully it didn’t take too long
to see there is a copy paste error in the if statement.</p>
<div class="codewrapper sourceCode" id="cb23">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb23-1"><a href="#cb23-1" tabindex="-1"></a><span class="cf">if</span> (red_lo_x <span class="op">&gt;=</span> blue_hi_x) <span class="kw">or</span> (red_hi_x <span class="op">&lt;=</span> blue_lo_x) <span class="kw">or</span> <span class="op">\</span></span>
<span id="cb23-2"><a href="#cb23-2" tabindex="-1"></a>        (red_lo_y <span class="op">&gt;=</span> blue_hi_x) <span class="kw">or</span> (red_hi_y <span class="op">&lt;=</span> blue_lo_y):</span>
<span id="cb23-3"><a href="#cb23-3" tabindex="-1"></a>                            <span class="co"># ^ should be y!</span></span></code></pre>
</div>
<p>Notice that all our other tests didn’t exercise this condition. If we
weren’t rotating each case we would have also missed this. At least the
fix is easy.</p>
</div>
</div>
</div>
</div>
<p>In contrast to the last implementation change we made (removing the
trailing tab character) this bug fix is more serious. You have revealed
an error in code that was previously published! Were this a real
example, you should open an issue with the original code and consider
rerunning any dependent analyses to see if results fundamentally change.
It may be by chance that branch of code never actually ran and it didn’t
matter if it were wrong. Maybe only 1% of cases were miscalled. That
would require just a new version to patch the issue. Larger changes in
the results may necessitate a revision or retraction of the original
publication.</p>
<div id="keypoints1" class="callout keypoints">
<div class="callout-square">
<i class="callout-icon" data-feather="key"></i>
</div>
<div class="callout-inner">
<h3 class="callout-title">Key Points</h3>
<div class="callout-content">
<ul><li>Testing long methods is difficult since you can’t pinpoint a few
lines of logic.</li>
<li>Testable code is also good code!</li>
<li>Changing code without tests can be dangerous. Work slowly and
carefully making only the simplest changes first.</li>
<li>Write tests with an adversarial viewpoint.</li>
<li>Keep tests DRY, fixtures and parameter can help.</li>
</ul></div>
</div>
</div>
<!--
Place links that you need to refer to multiple times across pages here. Delete
any links that you are not going to use.
 -->
</div>
</div>



      </div> <!-- / div.lesson-content -->
    </main><!-- / main#main-content.main-content --><nav class="bottom-pagination mx-md-4" aria-label="Previous and Next Chapter"><div class="d-block d-sm-block d-md-none">
        <a class="chapter-link" href="../instructor/TDD.html"><i aria-hidden="true" class="small-arrow" data-feather="arrow-left"></i>Previous</a>
        <a class="chapter-link float-end" href="../instructor/big-changes.html">Next<i aria-hidden="true" class="small-arrow" data-feather="arrow-right"></i></a>
      </div>
      <!-- content for large screens -->
      <div class="d-none d-sm-none d-md-block">
        <a class="chapter-link" href="../instructor/TDD.html" rel="prev">
          <i aria-hidden="true" class="small-arrow" data-feather="arrow-left"></i>
          Previous: Test Driven
        </a>
        <a class="chapter-link float-end" href="../instructor/big-changes.html" rel="next">
          Next: Testing Big Changes...
          <i aria-hidden="true" class="small-arrow" data-feather="arrow-right"></i>
        </a>
      </div>
    </nav></div> <!-- / div.primary-content.col-xs-12 -->
<!-- END:   inst/pkgdown/templates/content-instructor.html-->

      </div><!--/div.row-->
      		<footer class="row footer mx-md-3"><hr><div class="col-md-6">
        <p>This lesson is subject to the <a href="CODE_OF_CONDUCT.html">Code of Conduct</a></p>
        <p>

        <a href="https://github.com/INTERSECT-training/testing-lesson/edit/main/episodes/refactor-for-testing.md" class="external-link">Edit on GitHub</a>

	
        | <a href="https://github.com/INTERSECT-training/testing-lesson/blob/main/CONTRIBUTING.md" class="external-link">Contributing</a>
        | <a href="https://github.com/INTERSECT-training/testing-lesson/" class="external-link">Source</a></p>
				<p><a href="https://github.com/INTERSECT-training/testing-lesson/blob/main/CITATION.cff" class="external-link">Cite</a> | <a href="mailto:icosden@princeton.edu">Contact</a> | <a href="https://carpentries.org/about/" class="external-link">About</a></p>
			</div>
			<div class="col-md-6">

        <p>Materials licensed under <a href="LICENSE.html">CC-BY 4.0</a> by the authors</p>

        <p>Template licensed under <a href="https://creativecommons.org/licenses/by-sa/4.0/" class="external-link">CC-BY 4.0</a> by <a href="https://carpentries.org/" class="external-link">The Carpentries</a></p>
        <p>Built with <a href="https://github.com/carpentries/sandpaper/tree/0.16.12" class="external-link">sandpaper (0.16.12)</a>, <a href="https://github.com/carpentries/pegboard/tree/0.7.9" class="external-link">pegboard (0.7.9)</a>, and <a href="https://github.com/intersect-training/varnish/tree/406bb97bab56e8a0c29f2f362164c5d4a05b7ee1" class="external-link">varnish (1.0.7.9000)</a></p>
			</div>
		</footer></div> <!-- / div.container -->
	<div id="to-top">
		<a href="#top">
      <i class="search-icon" data-feather="arrow-up" role="img" aria-label="Back To Top"></i><br><!-- <span class="d-none d-sm-none d-md-none d-lg-none d-xl-block">Back</span> To Top --><span class="d-none d-sm-none d-md-none d-lg-none d-xl-block">Back</span> To Top
		</a>
	</div>
  <script type="application/ld+json">
    {
  "@context": "https://schema.org",
  "@type": "LearningResource",
  "@id": "https://INTERSECT-training.github.io/testing-lesson/instructor/refactor-for-testing.html",
  "inLanguage": "en",
  "dct:conformsTo": "https://bioschemas.org/profiles/LearningResource/1.0-RELEASE",
  "description": "A Carpentries Lesson teaching foundational data and coding skills to researchers worldwide",
  "keywords": "software, data, lesson, The Carpentries",
  "name": "Refactoring for Testing",
  "creativeWorkStatus": "active",
  "url": "https://INTERSECT-training.github.io/testing-lesson/instructor/refactor-for-testing.html",
  "identifier": "https://INTERSECT-training.github.io/testing-lesson/instructor/refactor-for-testing.html",
  "dateCreated": "2025-05-21",
  "dateModified": "2025-05-21",
  "datePublished": "2025-05-27"
}

  </script><script>
		feather.replace();
	</script></body></html><!-- END:   inst/pkgdown/templates/layout.html-->

